<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель | Petochania</title>
    <link rel="shortcut icon" href="img/free-icon-kitten-5389298.png">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Backend Services -->
    <script src="sync-config-loader.js"></script>
    <script src="github-sync-backend.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Lato', 'Arial', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            display: flex;
            min-height: 100vh;
            margin: 0;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
        }
        
        .logo {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #34495e;
        }
        
        .logo h1 {
            font-size: 20px;
            color: #C8A97E;
            font-family: 'Playfair Display', serif;
        }
        
        .nav-links {
            padding: 20px 0;
        }
        
        .nav-links a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #bdc3c7;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background: #34495e;
            color: white;
            border-left: 4px solid #C8A97E;
        }
        
        .nav-links i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h2 {
            color: #2c3e50;
            font-family: 'Playfair Display', serif;
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #C8A97E;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* Content Sections */
        .content-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f1f1;
            font-family: 'Playfair Display', serif;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: #C8A97E;
            outline: none;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #C8A97E;
            color: white;
        }
        
        .btn-primary:hover {
            background: #b8945a;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid #C8A97E;
            color: #C8A97E;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .card-header {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }
        
        .card-body {
            padding: 15px;
        }
        
        .card-footer {
            padding: 15px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .login-form {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
            font-family: 'Playfair Display', serif;
        }
        
        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-available {
            background: #d4edda;
            color: #155724;
        }
        
        .status-reserved {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-sold {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* File Upload */
        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: border 0.3s;
        }
        
        .file-upload:hover {
            border-color: #C8A97E;
        }
        
        .file-upload i {
            font-size: 40px;
            color: #C8A97E;
            margin-bottom: 10px;
        }
        
        .uploaded-images {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .uploaded-image {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .uploaded-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
        }

        /* Video Upload Styles */
        .uploaded-videos {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .uploaded-video {
            position: relative;
            display: inline-block;
        }

        .uploaded-video video {
            width: 150px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            border: 2px solid #007bff;
        }

        .uploaded-video .remove-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Preview */
        .preview-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }

        /* Стили для карточек котят в редакторе */
        .kitten-card-editor {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .kitten-card-editor:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .kitten-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .kitten-editor-header h4 {
            color: #2c3e50;
            margin: 0;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #C8A97E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Alert messages */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .logo h1, .sidebar .nav-links span {
                display: none;
            }
            
            .sidebar .nav-links a {
                justify-content: center;
                padding: 15px;
            }
            
            .sidebar .nav-links i {
                margin-right: 0;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .kitten-editor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-form">
            <h2>Вход в админ-панель</h2>
            <div class="form-group">
                <label for="username">Логин</label>
                <input type="text" id="username" class="form-control" placeholder="Введите логин" value="admin">
            </div>
            <div class="form-group">
                <label for="password">Пароль</label>
                <input type="password" id="password" class="form-control" placeholder="Введите пароль" value="admin">
            </div>
            <button id="loginBtn" class="btn btn-primary" style="width: 100%;">
                <span id="loginText">Войти</span>
                <div id="loginLoading" class="loading" style="display: none; margin: 0 auto;"></div>
            </button>
            <div id="loginMessage" style="margin-top: 15px; text-align: center; color: #e74c3c;"></div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" style="display: none; width: 100%;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>Petochania Admin</h1>
            </div>
            <div class="nav-links">
                <a href="#" class="active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> <span>Дашборд</span></a>
                <a href="#" data-tab="cats"><i class="fas fa-cat"></i> <span>Кошки</span></a>
                <a href="#" data-tab="breed-pages"><i class="fas fa-file-alt"></i> <span>Страницы пород</span></a>
                <a href="#" data-tab="gallery"><i class="fas fa-images"></i> <span>Галерея</span></a>
                <a href="#" data-tab="faq"><i class="fas fa-question-circle"></i> <span>FAQ</span></a>
                <a href="#" data-tab="reviews"><i class="fas fa-star"></i> <span>Отзывы</span></a>
                <a href="#" data-tab="videos"><i class="fas fa-video"></i> <span>Видео</span></a>
                <a href="#" data-tab="settings"><i class="fas fa-cog"></i> <span>Настройки</span></a>
                <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> <span>Выйти</span></a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2 id="pageTitle">Дашборд</h2>
                <div class="admin-info">
                    <div class="admin-avatar">A</div>
                    <span>Администратор</span>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="content-section">
                    <h3 class="section-title">Общая статистика</h3>
                    <div class="cards-grid">
                        <div class="card">
                            <div class="card-header">
                                <h4>Всего кошек</h4>
                            </div>
                            <div class="card-body">
                                <h2 id="totalCats">0</h2>
                                <p>Зарегистрировано в системе</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h4>Доступные котята</h4>
                            </div>
                            <div class="card-body">
                                <h2 id="availableCats">0</h2>
                                <p>Готовы к переезду</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h4>Вопросы в FAQ</h4>
                            </div>
                            <div class="card-body">
                                <h2 id="totalQuestions">0</h2>
                                <p>Активных вопросов</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h4>Отзывы</h4>
                            </div>
                            <div class="card-body">
                                <h2 id="totalReviews">0</h2>
                                <p>Опубликовано на сайте</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-section">
                    <h3 class="section-title">Быстрые действия</h3>
                    <div class="form-row">
                        <button class="btn btn-primary" data-tab="cats">
                            <i class="fas fa-plus"></i> Добавить кошку
                        </button>
                        <button class="btn btn-primary" data-tab="breed-pages">
                            <i class="fas fa-edit"></i> Редактировать породы
                        </button>
                        <button class="btn btn-primary" data-tab="videos">
                            <i class="fas fa-video"></i> Добавить видео
                        </button>
                    </div>
                </div>

                <div class="content-section">
                    <h3 class="section-title">Последние действия</h3>
                    <div id="recentActivity">
                        <p>Здесь будут отображаться последние действия...</p>
                    </div>
                </div>
            </div>

            <!-- Cats Tab -->
            <div id="cats" class="tab-content">
                <div class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 class="section-title" style="margin: 0;">Управление кошками</h3>
                        <div>
                            <button class="btn btn-secondary" onclick="loadCatsList()" title="Обновить список">
                                <i class="fas fa-redo"></i> Обновить
                            </button>
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-subtab="cats-list">Список кошек</div>
                        <div class="tab" data-subtab="add-cat">Добавить кошку</div>
                    </div>
                    
                    <!-- Cats List -->
                    <div id="cats-list" class="tab-content active">
                        <div class="form-group" style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <input type="text" id="searchCats" class="form-control" placeholder="Поиск по имени или породе...">
                            <button class="btn btn-secondary" onclick="loadCatsList()" title="Обновить список" style="white-space: nowrap;">
                                <i class="fas fa-redo"></i> Обновить
                            </button>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Имя</th>
                                    <th>Порода</th>
                                    <th>Пол</th>
                                    <th>Статус</th>
                                    <th>Дата добавления</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="catsTableBody">
                                <tr>
                                    <td colspan="6" style="text-align: center;">Загрузка данных...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Add Cat Form -->
                    <div id="add-cat" class="tab-content">
                        <form id="catForm">
                            <input type="hidden" id="editingCatId" value="">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="catName">Имя кошки *</label>
                                    <input type="text" id="catName" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="catBreed">Порода *</label>
                                    <select id="catBreed" class="form-control" required>
                                        <option value="">Выберите породу</option>
                                        <option value="Золотая Шиншилла">Золотая Шиншилла</option>
                                        <option value="Девон-рекс">Девон-рекс</option>
                                        <option value="Манчкин">Манчкин</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="catGender">Пол *</label>
                                    <select id="catGender" class="form-control" required>
                                        <option value="">Выберите пол</option>
                                        <option value="Девочка">Девочка</option>
                                        <option value="Мальчик">Мальчик</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="catStatus">Статус *</label>
                                    <select id="catStatus" class="form-control" required>
                                        <option value="">Выберите статус</option>
                                        <option value="ДОСТУПЕН">Доступен</option>
                                        <option value="ЗАБРОНИРОВАН">Забронирован</option>
                                        <option value="ПРОДАН">Продан</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="catColor">Окрас *</label>
                                    <input type="text" id="catColor" class="form-control" required placeholder="Например: золотистая завуалированная">
                                </div>
                                <div class="form-group">
                                    <label for="catAge">Возраст (мес.)</label>
                                    <input type="number" id="catAge" class="form-control" min="1" max="36" placeholder="Возраст в месяцах">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="catPrice">Цена (руб)</label>
                                    <input type="number" id="catPrice" class="form-control" placeholder="Стоимость котенка">
                                </div>
                                <div class="form-group">
                                    <label for="catLitter">Помет</label>
                                    <input type="text" id="catLitter" class="form-control" placeholder="Например: ПОМЕТ Т от 02/03/2025">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="catParents">Родители</label>
                                <textarea id="catParents" class="form-control" placeholder="Опишите родителей кошки"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="catDescription">Описание породы</label>
                                <textarea id="catDescription" class="form-control" placeholder="Опишите особенности породы"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="catCharacteristics">Характеристики</label>
                                <textarea id="catCharacteristics" class="form-control" placeholder="Опишите характер кошки"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Фотографии кошки</label>
                                <div class="file-upload" id="catImageUpload">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Перетащите сюда изображения или нажмите для загрузки</p>
                                    <input type="file" id="catImages" multiple accept="image/*" style="display: none;">
                                </div>
                                <div class="uploaded-images" id="catUploadedImages">
                                    <!-- Uploaded images will appear here -->
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <button type="submit" class="btn btn-primary">
                                    <span id="catSubmitText">Добавить кошку</span>
                                    <div id="catSubmitLoading" class="loading" style="display: none; margin-left: 10px;"></div>
                                </button>
                                <button type="button" class="btn btn-secondary" id="resetCatForm">Очистить форму</button>
                                <button type="button" class="btn btn-danger" id="cancelEdit" style="display: none;">Отмена</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Breed Pages Tab -->
            <div id="breed-pages" class="tab-content">
                <div class="content-section">
                    <h3 class="section-title">Управление страницами пород</h3>
                    
                    <div class="tabs">
                        <div class="tab active" data-subtab="breed-pages-list">Все страницы</div>
                        <div class="tab" data-subtab="edit-breed-page">Редактировать страницу</div>
                    </div>
                    
                    <!-- Breed Pages List -->
                    <div id="breed-pages-list" class="tab-content active">
                        <div class="form-group">
                            <input type="text" id="searchBreedPages" class="form-control" placeholder="Поиск по названию породы...">
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Порода</th>
                                    <th>URL страницы</th>
                                    <th>Последнее обновление</th>
                                    <th>Котят</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="breedPagesTableBody">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Загрузка данных...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Edit Breed Page Form -->
                    <div id="edit-breed-page" class="tab-content">
                        <form id="breedPageForm">
                            <input type="hidden" id="currentBreedId">
                            
                            <div class="form-group">
                                <label for="breedPageTitle">Название породы *</label>
                                <input type="text" id="breedPageTitle" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="breedHeroDescription">Текст под заголовком (герой-секция) *</label>
                                <textarea id="breedHeroDescription" class="form-control" required rows="3" placeholder="Краткое описание в герой-секции..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="breedPageDescription">Описание породы *</label>
                                <textarea id="breedPageDescription" class="form-control" required rows="6" placeholder="Подробное описание породы..."></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="breedOrigin">Происхождение</label>
                                    <input type="text" id="breedOrigin" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="breedWeight">Вес</label>
                                    <input type="text" id="breedWeight" class="form-control" placeholder="4-6 кг">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="breedLifespan">Продолжительность жизни</label>
                                    <input type="text" id="breedLifespan" class="form-control" placeholder="12-15 лет">
                                </div>
                                <div class="form-group">
                                    <label for="breedTemperament">Темперамент</label>
                                    <input type="text" id="breedTemperament" class="form-control" placeholder="Спокойный, нежный">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="breedCharacteristics">Характеристики (через запятую)</label>
                                <input type="text" id="breedCharacteristics" class="form-control" placeholder="Любопытный, Дружелюбный, Элегантный">
                            </div>
                            
                            <div class="form-group">
                                <label>Главное изображение породы</label>
                                <div class="file-upload" id="breedMainImageUpload">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Перетащите сюда изображение или нажмите для загрузки</p>
                                    <input type="file" id="breedMainImage" accept="image/*" style="display: none;">
                                </div>
                                <div class="uploaded-images" id="breedMainImagePreview">
                                    <!-- Uploaded image will appear here -->
                                </div>
                            </div>
                            
                            <!-- Котята для этой породы -->
                            <div class="form-group" style="margin-top: 40px; border-top: 2px solid #f1f1f1; padding-top: 30px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <label style="font-size: 20px; color: #2c3e50; margin: 0;">Доступные котята этой породы</label>
                                    <div style="display: flex; gap: 10px;">
                                        <button type="button" class="btn btn-success" onclick="addKittenFromBreedPage()">
                                            <i class="fas fa-plus"></i> Добавить котенка
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="assignExistingKittenToBreed()">
                                            <i class="fas fa-link"></i> Привязать существующего
                                        </button>
                                    </div>
                                </div>
                                <p style="color: #666; margin-bottom: 20px;">
                                    Котята, которые отображаются на странице этой породы
                                </p>
                                
                                <div id="breedKittensContainer">
                                    <!-- Список котят будет загружен здесь -->
                                    <div style="text-align: center; padding: 40px; color: #7f8c8d;">
                                        <i class="fas fa-cat" style="font-size: 48px; margin-bottom: 20px; display: block;"></i>
                                        <p>Загрузка котят...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <button type="submit" class="btn btn-primary">
                                    <span id="breedPageSubmitText">Сохранить изменения</span>
                                    <div id="breedPageSubmitLoading" class="loading" style="display: none; margin-left: 10px;"></div>
                                </button>
                                <button type="button" class="btn btn-secondary" id="previewBreedPage">Предпросмотр</button>
                                <button type="button" class="btn btn-secondary" id="resetBreedPageForm">Очистить форму</button>
                                <button type="button" class="btn btn-danger" id="deleteBreedPage" style="display: none;">Удалить страницу</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ВСТАВЬТЕ ЭТОТ КОД В admin-panel-backend.html ЗАМЕНИВ СУЩЕСТВУЮЩИЕ РАЗДЕЛЫ -->
<!-- =================================== FAQ TAB =================================== -->
<div id="faq" class="tab-content">
    <div class="content-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 class="section-title" style="margin: 0;">Управление FAQ</h3>
            <button class="btn btn-success" id="addFaqBtn">
                <i class="fas fa-plus"></i> Добавить вопрос
            </button>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-subtab="faq-list">Все вопросы</div>
            <div class="tab" data-subtab="edit-faq">Редактировать вопрос</div>
        </div>
        
        <!-- FAQ List -->
        <div id="faq-list" class="tab-content active">
            <div class="form-group" style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="searchFaq" class="form-control" placeholder="Поиск по вопросу или ответу...">
                <button class="btn btn-secondary" onclick="loadFaqList()" title="Обновить список">
                    <i class="fas fa-redo"></i> Обновить
                </button>
            </div>
            
            <table class="table">
                <thead>
                    <tr>
                        <th width="50">#</th>
                        <th>Вопрос</th>
                        <th>Ответ</th>
                        <th>Категория</th>
                        <th>Порядок</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody id="faqTableBody">
                    <tr>
                        <td colspan="6" style="text-align: center;">Загрузка вопросов...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Edit FAQ Form -->
        <div id="edit-faq" class="tab-content">
            <form id="faqForm">
                <input type="hidden" id="editingFaqId" value="">
                
                <div class="form-group">
                    <label for="faqQuestion">Вопрос *</label>
                    <input type="text" id="faqQuestion" class="form-control" required placeholder="Введите вопрос">
                </div>
                
                <div class="form-group">
                    <label for="faqAnswer">Ответ *</label>
                    <textarea id="faqAnswer" class="form-control" required rows="6" placeholder="Введите ответ"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="faqCategory">Категория</label>
                        <input type="text" id="faqCategory" class="form-control" placeholder="Например: Общие вопросы">
                    </div>
                    <div class="form-group">
                        <label for="faqOrder">Порядок отображения</label>
                        <input type="number" id="faqOrder" class="form-control" min="1" max="100" value="1">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="faqTags">Теги (через запятую)</label>
                    <input type="text" id="faqTags" class="form-control" placeholder="котята, документы, доставка">
                </div>
                
                <div class="form-group">
                    <div class="form-check">
                        <input type="checkbox" id="faqActive" class="form-check-input" checked>
                        <label class="form-check-label" for="faqActive">Активный вопрос (отображается на сайте)</label>
                    </div>
                </div>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">
                        <span id="faqSubmitText">Сохранить вопрос</span>
                        <div id="faqSubmitLoading" class="loading" style="display: none; margin-left: 10px;"></div>
                    </button>
                    <button type="button" class="btn btn-secondary" id="resetFaqForm">Очистить форму</button>
                    <button type="button" class="btn btn-danger" id="deleteFaqBtn" style="display: none;">Удалить вопрос</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- =================================== REVIEWS TAB =================================== -->
<div id="reviews" class="tab-content">
    <div class="content-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 class="section-title" style="margin: 0;">Управление отзывами</h3>
            <button class="btn btn-success" id="addReviewBtn">
                <i class="fas fa-plus"></i> Добавить отзыв
            </button>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-subtab="reviews-list">Все отзывы</div>
            <div class="tab" data-subtab="edit-review">Редактировать отзыв</div>
        </div>
        
        <!-- Reviews List -->
        <div id="reviews-list" class="tab-content active">
            <div class="form-group" style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="searchReviews" class="form-control" placeholder="Поиск по имени или тексту...">
                <button class="btn btn-secondary" onclick="loadReviewsList()" title="Обновить список">
                    <i class="fas fa-redo"></i> Обновить
                </button>
            </div>
            
            <table class="table">
                <thead>
                    <tr>
                        <th>Автор</th>
                        <th>Текст отзыва</th>
                        <th>Рейтинг</th>
                        <th>Город</th>
                        <th>Дата</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody id="reviewsTableBody">
                    <tr>
                        <td colspan="6" style="text-align: center;">Загрузка отзывов...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Edit Review Form -->
        <div id="edit-review" class="tab-content">
            <form id="reviewForm">
                <input type="hidden" id="editingReviewId" value="">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="reviewAuthor">Имя автора *</label>
                        <input type="text" id="reviewAuthor" class="form-control" required placeholder="Введите имя">
                    </div>
                    <div class="form-group">
                        <label for="reviewCity">Город</label>
                        <input type="text" id="reviewCity" class="form-control" placeholder="Например: Москва">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="reviewRating">Рейтинг (1-5)</label>
                        <div class="rating-input">
                            <div id="ratingStars" style="display: flex; gap: 5px; font-size: 24px;">
                                <i class="fas fa-star" data-rating="1" style="cursor: pointer; color: #ddd;"></i>
                                <i class="fas fa-star" data-rating="2" style="cursor: pointer; color: #ddd;"></i>
                                <i class="fas fa-star" data-rating="3" style="cursor: pointer; color: #ddd;"></i>
                                <i class="fas fa-star" data-rating="4" style="cursor: pointer; color: #ddd;"></i>
                                <i class="fas fa-star" data-rating="5" style="cursor: pointer; color: #ddd;"></i>
                            </div>
                            <input type="hidden" id="reviewRating" value="5">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="reviewDate">Дата отзыва</label>
                        <input type="date" id="reviewDate" class="form-control">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="reviewText">Текст отзыва *</label>
                    <textarea id="reviewText" class="form-control" required rows="6" placeholder="Введите текст отзыва"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Фотография автора</label>
                    <div class="file-upload" id="reviewImageUpload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Перетащите сюда изображение или нажмите для загрузки</p>
                        <input type="file" id="reviewImage" accept="image/*" style="display: none;">
                    </div>
                    <div class="uploaded-images" id="reviewImagePreview">
                        <!-- Uploaded image will appear here -->
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" id="reviewFeatured" class="form-check-input">
                            <label class="form-check-label" for="reviewFeatured">Показать на главной странице</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" id="reviewActive" class="form-check-input" checked>
                            <label class="form-check-label" for="reviewActive">Активный отзыв</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">
                        <span id="reviewSubmitText">Сохранить отзыв</span>
                        <div id="reviewSubmitLoading" class="loading" style="display: none; margin-left: 10px;"></div>
                    </button>
                    <button type="button" class="btn btn-secondary" id="resetReviewForm">Очистить форму</button>
                    <button type="button" class="btn btn-danger" id="deleteReviewBtn" style="display: none;">Удалить отзыв</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- =================================== VIDEOS TAB =================================== -->
<div id="videos" class="tab-content">
    <div class="content-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 class="section-title" style="margin: 0;">Управление видео</h3>
            <button class="btn btn-success" id="addVideoBtn">
                <i class="fas fa-plus"></i> Добавить видео
            </button>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-subtab="videos-list">Все видео</div>
            <div class="tab" data-subtab="edit-video">Редактировать видео</div>
        </div>
        
        <!-- Videos List -->
        <div id="videos-list" class="tab-content active">
            <div class="form-group" style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="searchVideos" class="form-control" placeholder="Поиск по названию...">
                <button class="btn btn-secondary" onclick="loadVideosList()" title="Обновить список">
                    <i class="fas fa-redo"></i> Обновить
                </button>
            </div>
            
            <div class="videos-grid" id="videosGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                <!-- Videos will be loaded here -->
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7f8c8d;">
                    <i class="fas fa-video" style="font-size: 48px; margin-bottom: 20px; display: block;"></i>
                    <p>Загрузка видео...</p>
                </div>
            </div>
        </div>
        
        <!-- Edit Video Form -->
        <div id="edit-video" class="tab-content">
            <form id="videoForm">
                <input type="hidden" id="editingVideoId" value="">
                
                <div class="form-group">
                    <label for="videoTitle">Название видео *</label>
                    <input type="text" id="videoTitle" class="form-control" required placeholder="Введите название">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="videoUrl">URL видео (YouTube или прямой ссылка) *</label>
                        <input type="url" id="videoUrl" class="form-control" required placeholder="https://youtube.com/watch?v=... или https://example.com/video.mp4">
                        <small class="text-muted">Поддерживаются YouTube ссылки и прямые ссылки на MP4/WebM файлы</small>
                    </div>
                    <div class="form-group">
                        <label for="videoType">Тип видео</label>
                        <select id="videoType" class="form-control">
                            <option value="youtube">YouTube</option>
                            <option value="direct">Прямая ссылка</option>
                            <option value="uploaded">Загруженное</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="videoDescription">Описание</label>
                    <textarea id="videoDescription" class="form-control" rows="4" placeholder="Описание видео"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Превью-изображение (постер)</label>
                    <div class="file-upload" id="videoThumbnailUpload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Перетащите сюда изображение или нажмите для загрузки</p>
                        <input type="file" id="videoThumbnail" accept="image/*" style="display: none;">
                    </div>
                    <div class="uploaded-images" id="videoThumbnailPreview">
                        <!-- Uploaded thumbnail will appear here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Или загрузите видео файл</label>
                    <div class="file-upload" id="videoFileUpload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Перетащите сюда видео файл (MP4, WebM) или нажмите для загрузки</p>
                        <input type="file" id="videoFile" accept="video/*" style="display: none;">
                    </div>
                    <div class="uploaded-videos" id="videoFilePreview">
                        <!-- Uploaded video will appear here -->
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="videoOrder">Порядок отображения</label>
                        <input type="number" id="videoOrder" class="form-control" min="1" max="100" value="1">
                    </div>
                    <div class="form-group">
                        <label for="videoCategory">Категория</label>
                        <select id="videoCategory" class="form-control">
                            <option value="main">Главная страница</option>
                            <option value="about">О питомнике</option>
                            <option value="breed">Породы</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" id="videoActive" class="form-check-input" checked>
                            <label class="form-check-label" for="videoActive">Активное видео</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" id="videoAutoplay" class="form-check-input" checked>
                            <label class="form-check-label" for="videoAutoplay">Автовоспроизведение</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">
                        <span id="videoSubmitText">Сохранить видео</span>
                        <div id="videoSubmitLoading" class="loading" style="display: none; margin-left: 10px;"></div>
                    </button>
                    <button type="button" class="btn btn-secondary" id="resetVideoForm">Очистить форму</button>
                    <button type="button" class="btn btn-danger" id="deleteVideoBtn" style="display: none;">Удалить видео</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- =================================== SETTINGS TAB =================================== -->
<div id="settings" class="tab-content">
    <div class="content-section">
        <h3 class="section-title">Настройки сайта</h3>
        
        <div class="tabs">
            <div class="tab active" data-subtab="site-settings">Основные настройки</div>
            <div class="tab" data-subtab="social-settings">Социальные сети</div>
            <div class="tab" data-subtab="seo-settings">SEO</div>
            <div class="tab" data-subtab="sync-settings">Синхронизация данных</div>
        </div>
        
        <!-- Site Settings -->
        <div id="site-settings" class="tab-content active">
            <form id="siteSettingsForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="siteTitle">Название сайта *</label>
                        <input type="text" id="siteTitle" class="form-control" required value="Petochania">
                    </div>
                    <div class="form-group">
                        <label for="siteTagline">Слоган</label>
                        <input type="text" id="siteTagline" class="form-control" value="Питомник элитных кошек">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="contactPhone">Телефон *</label>
                        <input type="tel" id="contactPhone" class="form-control" required value="8 926 150 2870">
                    </div>
                    <div class="form-group">
                        <label for="contactEmail">Email</label>
                        <input type="email" id="contactEmail" class="form-control" placeholder="info@petochania.ru">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="contactAddress">Адрес</label>
                        <input type="text" id="contactAddress" class="form-control" placeholder="Москва, Россия">
                    </div>
                    <div class="form-group">
                        <label for="workingHours">Время работы</label>
                        <input type="text" id="workingHours" class="form-control" placeholder="Ежедневно 10:00 - 20:00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="siteDescription">Описание сайта</label>
                    <textarea id="siteDescription" class="form-control" rows="4" placeholder="Описание для поисковых систем"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Логотип сайта</label>
                    <div class="file-upload" id="siteLogoUpload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Перетащите сюда логотип или нажмите для загрузки</p>
                        <input type="file" id="siteLogo" accept="image/*" style="display: none;">
                    </div>
                    <div class="uploaded-images" id="siteLogoPreview">
                        <!-- Uploaded logo will appear here -->
                    </div>
                </div>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">
                        <span id="settingsSubmitText">Сохранить настройки</span>
                        <div id="settingsSubmitLoading" class="loading" style="display: none; margin-left: 10px;"></div>
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Social Settings -->
        <div id="social-settings" class="tab-content">
            <form id="socialSettingsForm">
                <div id="socialLinksContainer">
                    <!-- Social links will be loaded here -->
                </div>
                
                <button type="button" class="btn btn-secondary" onclick="addSocialLink()" style="margin-bottom: 20px;">
                    <i class="fas fa-plus"></i> Добавить социальную сеть
                </button>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">
                        <span id="socialSubmitText">Сохранить социальные сети</span>
                        <div id="socialSubmitLoading" class="loading" style="display: none; margin-left: 10px;"></div>
                    </button>
                </div>
            </form>
        </div>
        
        <!-- SEO Settings -->
        <div id="seo-settings" class="tab-content">
            <form id="seoSettingsForm">
                <div class="form-group">
                    <label for="metaTitle">Meta Title (главная)</label>
                    <input type="text" id="metaTitle" class="form-control" placeholder="До 60 символов">
                    <small class="text-muted" id="metaTitleCounter">0/60</small>
                </div>
                
                <div class="form-group">
                    <label for="metaDescription">Meta Description (главная)</label>
                    <textarea id="metaDescription" class="form-control" rows="3" placeholder="До 160 символов"></textarea>
                    <small class="text-muted" id="metaDescriptionCounter">0/160</small>
                </div>
                
                <div class="form-group">
                    <label for="metaKeywords">Ключевые слова</label>
                    <input type="text" id="metaKeywords" class="form-control" placeholder="через запятую">
                </div>
                
                <div class="form-group">
                    <label for="googleAnalytics">Код Google Analytics</label>
                    <textarea id="googleAnalytics" class="form-control" rows="4" placeholder="Вставьте код отслеживания"></textarea>
                </div>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">
                        <span id="seoSubmitText">Сохранить SEO настройки</span>
                        <div id="seoSubmitLoading" class="loading" style="display: none; margin-left: 10px;"></div>
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Sync Settings -->
        <div id="sync-settings" class="tab-content">
            <div class="alert alert-info" style="margin-bottom: 20px;">
                <i class="fas fa-info-circle"></i>
                <strong>Синхронизация данных между устройствами</strong><br>
                Для синхронизации данных между устройствами настройте GitHub Personal Access Token.
                Данные будут храниться в приватном GitHub Gist и автоматически синхронизироваться.
            </div>
            
            <form id="syncSettingsForm">
                <div class="form-group">
                    <label for="githubToken">GitHub Personal Access Token</label>
                    <input type="password" id="githubToken" class="form-control" 
                           placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" 
                           value="">
                    <small class="text-muted">
                        Создайте токен на <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings → Developer settings → Personal access tokens</a><br>
                        Требуемые права: <code>gist</code> (для создания и обновления Gist)
                    </small>
                </div>
                
                <div class="form-group" id="gistIdGroup" style="display: none;">
                    <label for="gistId">Gist ID (опционально)</label>
                    <input type="text" id="gistId" class="form-control" 
                           placeholder="Оставьте пустым для создания нового Gist">
                    <small class="text-muted">Если у вас уже есть Gist с данными, укажите его ID</small>
                </div>
                
                <div class="form-group">
                    <div id="syncStatus" class="alert" style="display: none;"></div>
                </div>
                
                <div class="form-row">
                    <button type="submit" class="btn btn-primary">
                        <span id="syncSubmitText">Сохранить настройки синхронизации</span>
                        <div id="syncSubmitLoading" class="loading" style="display: none; margin-left: 10px;"></div>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="testSyncConnection()">
                        <i class="fas fa-sync"></i> Проверить соединение
                    </button>
                </div>
            </form>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                <h4>Текущий статус синхронизации</h4>
                <div id="currentSyncStatus">
                    <p><strong>Бекенд:</strong> <span id="backendType">Определяется...</span></p>
                    <p><strong>Gist ID:</strong> <span id="currentGistId">Не настроен</span></p>
                    <p><strong>Последняя синхронизация:</strong> <span id="lastSyncTime">-</span></p>
                </div>
            </div>
        </div>
    </div>
</div>

    <script>
        // Configuration
        // Определяем, используем ли мы локальный сервер или GitHub Pages
        const API_BASE = `${window.location.origin}/api`;
        const USE_LOCAL_API = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        let authToken = localStorage.getItem('petochania_authToken') || '';
        let currentUser = null;
        let backend = null;

        // Инициализация бекенда
        async function initBackend() {
            // Если локальный сервер доступен, используем его
            if (USE_LOCAL_API) {
                try {
                    const testResponse = await fetch(`${API_BASE}/cats`, { method: 'GET' });
                    if (testResponse.ok || testResponse.status === 401) {
                        // Сервер доступен, используем Express API
                        console.log('✅ Используется локальный Express API');
                        backend = 'express';
                        return;
                    }
                } catch (error) {
                    console.warn('Локальный сервер недоступен, переключаемся на облачный бекенд');
                }
            }

            // Приоритет 1: GitHub Sync Backend (для синхронизации между устройствами)
            if (window.githubSyncBackend && window.githubSyncBackend.initialized) {
                backend = window.githubSyncBackend;
                console.log('✅ Используется GitHub Sync Backend');
                return;
            }

            // Используем GitHub Sync Backend (полностью бесплатный)
            if (window.githubSyncBackend) {
                backend = window.githubSyncBackend;
                await backend.init();
                if (backend.initialized) {
                    console.log('✅ Используется GitHub Sync Backend (бесплатный)');
                } else {
                    console.log('⚠️ GitHub Sync Backend не настроен. Используется localStorage (только локально)');
                }
                return;
            }

            // Последний fallback: простой localStorage
            console.warn('⚠️ Используется localStorage fallback (данные не синхронизируются между устройствами)');
            backend = {
                getCats: async () => JSON.parse(localStorage.getItem('petochania_cats') || '[]'),
                createCat: async (data) => {
                    const cats = JSON.parse(localStorage.getItem('petochania_cats') || '[]');
                    const cat = { ...data, id: 'cat_' + Date.now() };
                    cats.push(cat);
                    localStorage.setItem('petochania_cats', JSON.stringify(cats));
                    return { success: true, data: cat };
                },
                updateCat: async (id, data) => {
                    const cats = JSON.parse(localStorage.getItem('petochania_cats') || '[]');
                    const index = cats.findIndex(c => c.id === id);
                    if (index !== -1) {
                        cats[index] = { ...cats[index], ...data };
                        localStorage.setItem('petochania_cats', JSON.stringify(cats));
                    }
                    return { success: true, data };
                },
                deleteCat: async (id) => {
                    const cats = JSON.parse(localStorage.getItem('petochania_cats') || '[]');
                    const filtered = cats.filter(c => c.id !== id);
                    localStorage.setItem('petochania_cats', JSON.stringify(filtered));
                    return { success: true };
                },
                getBreedPages: async () => JSON.parse(localStorage.getItem('breedPages') || '{}'),
                updateBreedPage: async (id, data) => {
                    const pages = JSON.parse(localStorage.getItem('breedPages') || '{}');
                    pages[id] = data;
                    localStorage.setItem('breedPages', JSON.stringify(pages));
                    return { success: true, data };
                },
                login: async (username, password) => {
                    if (username === 'admin' && password === 'admin123') {
                        const token = 'token_' + Date.now();
                        localStorage.setItem('petochania_authToken', token);
                        return { success: true, token, user: { username, role: 'admin' } };
                    }
                    throw new Error('Неверный логин или пароль');
                }
            };
        }

        // API Service для работы с бекендом (совместимость с существующим кодом)
        const apiService = {
            // Вспомогательная функция для определения типа бекенда
            async ensureBackend() {
                if (!backend) await initBackend();
                return backend === 'express';
            },

            // Кошки
            async getCats() {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/cats`);
                        const data = await response.json();
                        return data?.data || [];
                    } catch (error) {
                        console.error('Error getting cats from Express:', error);
                        return [];
                    }
                }
                try {
                    if (backend && typeof backend.getCats === 'function') {
                        const cats = await backend.getCats();
                        return cats || [];
                    }
                    return [];
                } catch (error) {
                    console.error('Error getting cats:', error);
                    return [];
                }
            },

            async getCat(id) {
                try {
                    const cats = await this.getCats();
                    return cats.find(cat => cat.id == id);
                } catch (error) {
                    console.error('Error getting cat:', error);
                    return null;
                }
            },

            async createCat(catData) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/cats`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${authToken}`
                            },
                            body: JSON.stringify(catData)
                        });
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Error creating cat in Express:', error);
                        return { success: false, error: error.message };
                    }
                }
                try {
                    if (backend && typeof backend.createCat === 'function') {
                        const result = await backend.createCat(catData);
                        // Обновляем время последней синхронизации
                        if (result.success) {
                            localStorage.setItem('petochania_last_sync', new Date().toISOString());
                        }
                        return result;
                    }
                    return { success: false, error: 'Backend не поддерживает создание кошек' };
                } catch (error) {
                    console.error('Error creating cat:', error);
                    return { success: false, error: error.message };
                }
            },

            async updateCat(id, catData) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/cats/${id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${authToken}`
                            },
                            body: JSON.stringify(catData)
                        });
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Error updating cat in Express:', error);
                        return { success: false, error: error.message };
                    }
                }
                try {
                    if (backend && typeof backend.updateCat === 'function') {
                        const result = await backend.updateCat(id, catData);
                        if (result.success) {
                            localStorage.setItem('petochania_last_sync', new Date().toISOString());
                        }
                        return result;
                    }
                    return { success: false, error: 'Backend не поддерживает обновление кошек' };
                } catch (error) {
                    console.error('Error updating cat:', error);
                    return { success: false, error: error.message };
                }
            },

            async deleteCat(id) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/cats/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${authToken}`
                            }
                        });
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Error deleting cat in Express:', error);
                        return { success: false, error: error.message };
                    }
                }
                try {
                    if (backend && typeof backend.deleteCat === 'function') {
                        const result = await backend.deleteCat(id);
                        if (result.success) {
                            localStorage.setItem('petochania_last_sync', new Date().toISOString());
                        }
                        return result;
                    }
                    return { success: false, error: 'Backend не поддерживает удаление кошек' };
                } catch (error) {
                    console.error('Error deleting cat:', error);
                    return { success: false, error: error.message };
                }
            },

            // Страницы пород
            async getBreedPages() {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/breed-pages`);
                        const data = await response.json();
                        const pages = {};
                        (data?.data || []).forEach(page => {
                            pages[page.id] = page;
                        });
                        return pages;
                    } catch (error) {
                        console.error('Error getting breed pages from Express:', error);
                        return {};
                    }
                }
                try {
                    if (backend && typeof backend === 'object' && typeof backend.getBreedPages === 'function') {
                        const pages = await backend.getBreedPages();
                        return pages || {};
                    }
                    return {};
                } catch (error) {
                    console.error('Error getting breed pages:', error);
                    return {};
                }
            },

            async getBreedPage(id) {
                try {
                    const breedPages = await this.getBreedPages();
                    return breedPages[id];
                } catch (error) {
                    console.error('Error getting breed page:', error);
                    return null;
                }
            },

            async updateBreedPage(id, breedData) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/breed-pages/${id}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${authToken}`
                            },
                            body: JSON.stringify(breedData)
                        });
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Error updating breed page in Express:', error);
                        return { success: false, error: error.message };
                    }
                }
                try {
                    if (backend && typeof backend === 'object' && typeof backend.updateBreedPage === 'function') {
                        const result = await backend.updateBreedPage(id, breedData);
                        return result;
                    }
                    return { success: false, error: 'Backend не поддерживает обновление страниц пород' };
                } catch (error) {
                    console.error('Error updating breed page:', error);
                    return { success: false, error: error.message };
                }
            },

            // Авторизация
            async login(username, password) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/auth/login`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ username, password })
                        });
                        const data = await response.json();
                        if (data.success) {
                            authToken = data.token;
                            localStorage.setItem('petochania_authToken', authToken);
                            if (data.user) {
                                currentUser = data.user;
                                localStorage.setItem('petochania_currentUser', JSON.stringify(data.user));
                            }
                        }
                        return data;
                    } catch (error) {
                        console.error('Login error in Express:', error);
                        throw error;
                    }
                }
                try {
                    // Проверяем, что backend является объектом с методом login
                    if (backend && typeof backend === 'object' && typeof backend.login === 'function') {
                        const result = await backend.login(username, password);
                        if (result.success) {
                            authToken = result.token;
                            localStorage.setItem('petochania_authToken', authToken);
                            if (result.user) {
                                currentUser = result.user;
                                localStorage.setItem('petochania_currentUser', JSON.stringify(result.user));
                            }
                        }
                        return result;
                    } else {
                        // Fallback на простую проверку через localStorage
                        if (username === 'admin' && password === 'admin123') {
                            const token = 'token_' + Date.now();
                            authToken = token;
                            localStorage.setItem('petochania_authToken', token);
                            currentUser = { username, role: 'admin' };
                            localStorage.setItem('petochania_currentUser', JSON.stringify(currentUser));
                            return { success: true, token, user: currentUser };
                        }
                        throw new Error('Неверный логин или пароль');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    throw error;
                }
            },

            // Загрузка файлов
            async uploadFile(file) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const formData = new FormData();
                        formData.append('file', file);
                        const response = await fetch(`${API_BASE}/upload`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${authToken}`
                            },
                            body: formData
                        });
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Upload error in Express:', error);
                        throw error;
                    }
                }
                try {
                    if (backend && typeof backend === 'object' && typeof backend.uploadFile === 'function') {
                        return await backend.uploadFile(file);
                    }
                    // Fallback: base64
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const filename = Date.now() + '-' + file.name;
                            localStorage.setItem(`petochania_file_${filename}`, e.target.result);
                            resolve({
                                success: true,
                                filename: filename,
                                originalname: file.name,
                                url: e.target.result
                            });
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });
                } catch (error) {
                    console.error('Upload error:', error);
                    throw error;
                }
            },

            // FAQ
            async getFAQ() {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/faq`);
                        const data = await response.json();
                        return data?.data || [];
                    } catch (error) {
                        console.error('Error getting FAQ from Express:', error);
                        return [];
                    }
                }
                try {
                    if (backend && typeof backend === 'object' && typeof backend.getFAQ === 'function') {
                        return await backend.getFAQ();
                    }
                    return JSON.parse(localStorage.getItem('petochania_faq') || '[]');
                } catch (error) {
                    return [];
                }
            },

            async saveFAQ(faqData) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/faq`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${authToken}`
                            },
                            body: JSON.stringify(faqData)
                        });
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Error saving FAQ in Express:', error);
                        return { success: false, error: error.message };
                    }
                }
                try {
                    if (backend && typeof backend === 'object' && typeof backend.saveFAQ === 'function') {
                        return await backend.saveFAQ(faqData);
                    }
                    const faqs = JSON.parse(localStorage.getItem('petochania_faq') || '[]');
                    const index = faqs.findIndex(f => f.id === faqData.id);
                    if (index !== -1) {
                        faqs[index] = faqData;
                    } else {
                        faqs.push(faqData);
                    }
                    localStorage.setItem('petochania_faq', JSON.stringify(faqs));
                    return { success: true, data: faqData };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },

            async deleteFAQ(id) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/faq/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${authToken}`
                            }
                        });
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Error deleting FAQ in Express:', error);
                        return { success: false, error: error.message };
                    }
                }
                try {
                    if (backend && typeof backend === 'object' && typeof backend.deleteFAQ === 'function') {
                        return await backend.deleteFAQ(id);
                    }
                    const faqs = JSON.parse(localStorage.getItem('petochania_faq') || '[]');
                    const filtered = faqs.filter(f => f.id !== id);
                    localStorage.setItem('petochania_faq', JSON.stringify(filtered));
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },

            // Отзывы
            async getReviews() {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/reviews`);
                        const data = await response.json();
                        return data?.data || [];
                    } catch (error) {
                        console.error('Error getting reviews from Express:', error);
                        return [];
                    }
                }
                try {
                    if (backend && typeof backend === 'object' && typeof backend.getReviews === 'function') {
                        return await backend.getReviews();
                    }
                    return JSON.parse(localStorage.getItem('petochania_reviews') || '[]');
                } catch (error) {
                    return [];
                }
            },

            async saveReview(reviewData) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/reviews`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${authToken}`
                            },
                            body: JSON.stringify(reviewData)
                        });
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Error saving review in Express:', error);
                        return { success: false, error: error.message };
                    }
                }
                try {
                    if (backend && backend.saveReview) {
                        return await backend.saveReview(reviewData);
                    }
                    const reviews = JSON.parse(localStorage.getItem('petochania_reviews') || '[]');
                    const index = reviews.findIndex(r => r.id === reviewData.id);
                    if (index !== -1) {
                        reviews[index] = reviewData;
                    } else {
                        reviews.push(reviewData);
                    }
                    localStorage.setItem('petochania_reviews', JSON.stringify(reviews));
                    return { success: true, data: reviewData };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },

            // Настройки
            async getSettings() {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/settings`);
                        const data = await response.json();
                        return data?.data || {};
                    } catch (error) {
                        console.error('Error getting settings from Express:', error);
                        return {};
                    }
                }
                try {
                    if (backend && typeof backend === 'object' && typeof backend.getSettings === 'function') {
                        return await backend.getSettings();
                    }
                    return JSON.parse(localStorage.getItem('petochania_site_settings') || '{}');
                } catch (error) {
                    return {};
                }
            },

            async saveSettings(settings) {
                const useExpress = await this.ensureBackend();
                if (useExpress) {
                    try {
                        const response = await fetch(`${API_BASE}/settings`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${authToken}`
                            },
                            body: JSON.stringify(settings)
                        });
                        const data = await response.json();
                        return data;
                    } catch (error) {
                        console.error('Error saving settings in Express:', error);
                        return { success: false, error: error.message };
                    }
                }
                try {
                    if (backend && typeof backend === 'object' && typeof backend.saveSettings === 'function') {
                        return await backend.saveSettings(settings);
                    }
                    localStorage.setItem('petochania_site_settings', JSON.stringify(settings));
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }
        };

        // Инициализация при загрузке
        initBackend();

        // Utility Functions
        function showLoading(element) {
            element.style.display = 'inline-block';
        }

        function hideLoading(element) {
            element.style.display = 'none';
        }

        function showAlert(message, type = 'success') {
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            const firstContentSection = document.querySelector('.content-section');
            if (firstContentSection) {
                firstContentSection.insertBefore(alert, firstContentSection.firstChild);
            } else {
                document.body.appendChild(alert);
            }
            
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        function showMessage(message, type = 'info') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                z-index: 10000;
                max-width: 400px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
            `;
            
            if (type === 'success') {
                toast.style.backgroundColor = '#27ae60';
            } else if (type === 'error') {
                toast.style.backgroundColor = '#e74c3c';
            } else if (type === 'warning') {
                toast.style.backgroundColor = '#f39c12';
            } else {
                toast.style.backgroundColor = '#3498db';
            }
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Breed Pages Management
        let currentBreedPageData = null;
        let currentBreedMainImage = null;

        // Cats Management
        let currentCatImages = [];
        let editingCatId = null;

        // Получение бейджа статуса
        function getStatusBadge(status) {
            const statusClasses = {
                'ДОСТУПЕН': 'status-available',
                'ЗАБРОНИРОВАН': 'status-reserved',
                'ПРОДАН': 'status-sold'
            };
            
            return `<span class="status-badge ${statusClasses[status] || ''}">${status}</span>`;
        }

        // Инициализация формы страниц пород
        function initBreedPagesForm() {
            document.getElementById('breedPageForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await saveBreedPage();
            });

            // Загрузка главного изображения
            document.getElementById('breedMainImageUpload').addEventListener('click', function() {
                document.getElementById('breedMainImage').click();
            });
            
            document.getElementById('breedMainImage').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && !file.type.startsWith('image/')) {
                    showMessage('Пожалуйста, выберите изображение', 'error');
                    return;
                }
                
                if (file && file.size > 5 * 1024 * 1024) {
                    showMessage('Изображение слишком большое (макс. 5MB)', 'error');
                    return;
                }
                
                currentBreedMainImage = file;
                const preview = document.getElementById('breedMainImagePreview');
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `
                            <div class="uploaded-image">
                                <img src="${e.target.result}" alt="Uploaded breed image">
                                <div class="remove-image" onclick="removeBreedMainImage()">
                                    <i class="fas fa-times"></i>
                                </div>
                            </div>
                        `;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Предпросмотр
            document.getElementById('previewBreedPage').addEventListener('click', function() {
                previewBreedPage();
            });

            // Сброс формы
            document.getElementById('resetBreedPageForm').addEventListener('click', function() {
                if (confirm('Вы уверены, что хотите очистить форму? Все несохраненные изменения будут потеряны.')) {
                    document.getElementById('breedPageForm').reset();
                    document.getElementById('breedMainImagePreview').innerHTML = '';
                    currentBreedMainImage = null;
                    currentBreedPageData = null;
                    document.getElementById('currentBreedId').value = '';
                    document.getElementById('deleteBreedPage').style.display = 'none';
                    showMessage('Форма очищена', 'info');
                }
            });

            // Удаление страницы
            document.getElementById('deleteBreedPage').addEventListener('click', async function() {
                const breedId = document.getElementById('currentBreedId').value;
                if (!breedId) return;
                
                const breedTitle = document.getElementById('breedPageTitle').value;
                
                if (confirm(`Вы уверены, что хотите удалить страницу породы "${breedTitle}"? Это действие нельзя отменить.`)) {
                    try {
                        showMessage('Функция удаления страницы в разработке', 'warning');
                    } catch (error) {
                        showMessage('Ошибка удаления страницы', 'error');
                    }
                }
            });
        }

        // Инициализация формы кошек
        function initCatsForm() {
            document.getElementById('catForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await saveCat();
            });

            // Загрузка изображений кошки
            document.getElementById('catImageUpload').addEventListener('click', function() {
                document.getElementById('catImages').click();
            });
            
            document.getElementById('catImages').addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                handleCatImagesUpload(files);
            });

            // Drag and drop для изображений
            const catImageUpload = document.getElementById('catImageUpload');
            catImageUpload.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = '#C8A97E';
                this.style.backgroundColor = '#f8f9fa';
            });
            
            catImageUpload.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.borderColor = '#ddd';
                this.style.backgroundColor = '';
            });
            
            catImageUpload.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#ddd';
                this.style.backgroundColor = '';
                const files = Array.from(e.dataTransfer.files);
                handleCatImagesUpload(files);
            });

            // Сброс формы
            document.getElementById('resetCatForm').addEventListener('click', function() {
                resetCatForm();
            });

            // Отмена редактирования
            document.getElementById('cancelEdit').addEventListener('click', function() {
                resetCatForm();
            });

            // Поиск кошек
            document.getElementById('searchCats').addEventListener('input', function(e) {
                filterCats(e.target.value);
            });
        }

        function handleCatImagesUpload(files) {
            const uploadedImagesContainer = document.getElementById('catUploadedImages');
            
            files.forEach(file => {
                if (!file.type.startsWith('image/')) {
                    showMessage(`Файл "${file.name}" не является изображением`, 'warning');
                    return;
                }
                
                // Проверяем размер файла
                if (file.size > 5 * 1024 * 1024) {
                    showMessage(`Изображение "${file.name}" слишком большое. Максимальный размер: 5MB`, 'warning');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = {
                        id: Date.now().toString() + Math.random(),
                        url: e.target.result,
                        file: file
                    };
                    
                    currentCatImages.push(imageData);
                    
                    const imageElement = document.createElement('div');
                    imageElement.className = 'uploaded-image';
                    imageElement.innerHTML = `
                        <img src="${e.target.result}" alt="Uploaded cat image">
                        <div class="remove-image" onclick="removeCatImage('${imageData.id}')">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
                    
                    uploadedImagesContainer.appendChild(imageElement);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeCatImage(imageId) {
            currentCatImages = currentCatImages.filter(img => img.id !== imageId);
            const imageElement = document.querySelector(`[onclick="removeCatImage('${imageId}')"]`).parentElement;
            if (imageElement) {
                imageElement.remove();
            }
        }

        function removeBreedMainImage() {
            currentBreedMainImage = null;
            document.getElementById('breedMainImagePreview').innerHTML = '';
            document.getElementById('breedMainImage').value = '';
        }

        // Сброс формы кошки
        function resetCatForm() {
            if (editingCatId && !confirm('Вы уверены, что хотите отменить редактирование? Все несохраненные изменения будут потеряны.')) {
                return;
            }
            
            document.getElementById('catForm').reset();
            document.getElementById('catUploadedImages').innerHTML = '';
            currentCatImages = [];
            editingCatId = null;
            document.getElementById('editingCatId').value = '';
            document.getElementById('catSubmitText').textContent = 'Добавить кошку';
            document.getElementById('cancelEdit').style.display = 'none';
            showMessage('Форма очищена', 'info');
        }

        // Редактирование страницы породы
        async function editBreedPage(breedId) {
            try {
                let breedData;
                try {
                    breedData = await apiService.getBreedPage(breedId);
                } catch (error) {
                    console.log('Ошибка загрузки с сервера, пробуем localStorage:', error);
                    // Загружаем из localStorage
                    const breedPages = JSON.parse(localStorage.getItem('petochania_breedPages') || '{}');
                    breedData = breedPages[breedId];
                    
                    if (!breedData) {
                        const breedPagesLocal = JSON.parse(localStorage.getItem('breedPages') || '{}');
                        breedData = breedPagesLocal[breedId];
                    }
                }
                
                currentBreedPageData = breedData;
                document.getElementById('currentBreedId').value = breedId;
                
                // Заполняем форму данными или данными по умолчанию
                const defaultData = getDefaultBreedData(breedId);
                
                document.getElementById('breedPageTitle').value = breedData?.title || defaultData.title;
                document.getElementById('breedPageDescription').value = breedData?.description || defaultData.description;
                document.getElementById('breedHeroDescription').value = breedData?.heroDescription || defaultData.heroDescription;
                document.getElementById('breedOrigin').value = breedData?.origin || defaultData.origin;
                document.getElementById('breedWeight').value = breedData?.weight || defaultData.weight;
                document.getElementById('breedLifespan').value = breedData?.lifespan || defaultData.lifespan;
                document.getElementById('breedTemperament').value = breedData?.temperament || defaultData.temperament;
                document.getElementById('breedCharacteristics').value = breedData?.characteristics ? 
                    (Array.isArray(breedData.characteristics) ? breedData.characteristics.join(', ') : breedData.characteristics) : 
                    defaultData.characteristics.join(', ');
                
                // Показываем текущее изображение если есть
                const preview = document.getElementById('breedMainImagePreview');
                preview.innerHTML = '';
                
                if (breedData?.mainImage) {
                    preview.innerHTML = `
                        <div class="uploaded-image">
                            <img src="${breedData.mainImage}" alt="Current breed image">
                            <div class="remove-image" onclick="removeBreedMainImage()">
                                <i class="fas fa-times"></i>
                            </div>
                        </div>
                    `;
                } else {
                    // Показываем стандартное изображение
                    const defaultImages = {
                        'chinchilla': 'img/goldshinshina.JPG',
                        'devon': 'img/devon-reks.JPG',
                        'munchkin': 'img/machkin.JPG'
                    };
                    
                    if (defaultImages[breedId]) {
                        preview.innerHTML = `
                            <div class="uploaded-image">
                                <img src="${defaultImages[breedId]}" alt="Default breed image">
                                <div class="remove-image" onclick="removeBreedMainImage()">
                                    <i class="fas fa-times"></i>
                                </div>
                            </div>
                        `;
                    }
                }
                
                // Показываем кнопку удаления
                document.getElementById('deleteBreedPage').style.display = 'inline-block';
                
                // Загружаем котят для этой породы
                await loadBreedKittens(breedId);
                
                // Переключаемся на вкладку редактирования
                document.querySelector('[data-subtab="edit-breed-page"]').click();
                
                // Прокручиваем к началу формы
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                showMessage(`Редактирование страницы породы "${breedData?.title || defaultData.title}"`, 'info');
                
            } catch (error) {
                console.error('Error loading breed page:', error);
                showMessage('Ошибка загрузки страницы породы. Используются данные по умолчанию', 'warning');
                
                // Загружаем данные по умолчанию
                const defaultData = getDefaultBreedData(breedId);
                currentBreedPageData = defaultData;
                document.getElementById('currentBreedId').value = breedId;
                
                // Заполняем форму данными по умолчанию
                document.getElementById('breedPageTitle').value = defaultData.title;
                document.getElementById('breedPageDescription').value = defaultData.description;
                document.getElementById('breedHeroDescription').value = defaultData.heroDescription;
                document.getElementById('breedOrigin').value = defaultData.origin;
                document.getElementById('breedWeight').value = defaultData.weight;
                document.getElementById('breedLifespan').value = defaultData.lifespan;
                document.getElementById('breedTemperament').value = defaultData.temperament;
                document.getElementById('breedCharacteristics').value = defaultData.characteristics.join(', ');
                
                // Загружаем котят для этой породы
                await loadBreedKittens(breedId);
                
                // Переключаемся на вкладку редактирования
                document.querySelector('[data-subtab="edit-breed-page"]').click();
            }
        }

        // Добавление котенка к породе со страницы породы
        function addKittenFromBreedPage() {
            const breedId = document.getElementById('currentBreedId').value;
            const breedTitle = document.getElementById('breedPageTitle').value;
            
            if (!breedId || !breedTitle) {
                showMessage('Сначала сохраните информацию о породе', 'error');
                return;
            }
            
            // Автоматически устанавливаем породу
            document.getElementById('catBreed').value = breedTitle;
            
            // Переходим к форме добавления кошки
            document.querySelector('[data-tab="cats"]').click();
            document.querySelector('[data-subtab="add-cat"]').click();
            
            // Прокручиваем к форме
            document.getElementById('add-cat').scrollIntoView({ behavior: 'smooth' });
            
            showMessage(`Порода автоматически установлена: "${breedTitle}". Теперь заполните информацию о котенке`, 'info');
        }

        // Привязка существующего котенка к породе
        async function assignExistingKittenToBreed() {
            try {
                const breedId = document.getElementById('currentBreedId').value;
                const breedTitle = document.getElementById('breedPageTitle').value;
                
                if (!breedId || !breedTitle) {
                    showMessage('Сначала сохраните информацию о породе', 'error');
                    return;
                }
                
                // Получаем всех кошек
                const cats = await getCatsFromStorage();
                
                // Фильтруем кошек, которые не принадлежат этой породе или без породы
                const availableCats = cats.filter(cat => {
                    if (!cat.breed) return true;
                    return !cat.breed.toLowerCase().includes(breedTitle.toLowerCase());
                });
                
                if (availableCats.length === 0) {
                    showMessage('Нет доступных котят для привязки', 'info');
                    return;
                }
                
                // Создаем модальное окно выбора
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.7);
                    z-index: 3000;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    padding: 20px;
                `;
                
                const modalContent = document.createElement('div');
                modalContent.style.cssText = `
                    background: white;
                    border-radius: 15px;
                    padding: 30px;
                    width: 90%;
                    max-width: 800px;
                    max-height: 80vh;
                    overflow-y: auto;
                `;
                
                modalContent.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #2c3e50;">Выберите котенка для привязки к породе "${breedTitle}"</h3>
                        <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                                style="background: none; border: none; font-size: 20px; color: #666; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <p>Выберите существующего котенка, чтобы привязать его к породе <strong>${breedTitle}</strong></p>
                    </div>
                    <div id="assignCatsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        ${availableCats.map(cat => `
                            <div style="border: 1px solid #ddd; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.3s;"
                                 onclick="assignKittenToBreed('${cat.id}', '${breedTitle}', this)">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    ${cat.images && cat.images.length > 0 ? 
                                        `<img src="${cat.images[0]}" alt="${cat.name}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">` : 
                                        `<div style="width: 60px; height: 60px; border-radius: 8px; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-cat" style="color: #C8A97E;"></i>
                                        </div>`
                                    }
                                    <div>
                                        <h4 style="margin: 0; font-size: 16px;">${cat.name}</h4>
                                        <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">${cat.breed || 'Без породы'}</p>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <span style="font-size: 12px; background: #f8f9fa; padding: 3px 8px; border-radius: 4px;">${cat.gender}</span>
                                    <span style="font-size: 12px; background: #f8f9fa; padding: 3px 8px; border-radius: 4px;">${cat.color}</span>
                                    ${cat.age ? `<span style="font-size: 12px; background: #f8f9fa; padding: 3px 8px; border-radius: 4px;">${cat.age} мес.</span>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: center;">
                        <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                                style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Отмена
                        </button>
                    </div>
                `;
                
                modal.appendChild(modalContent);
                document.body.appendChild(modal);
                
            } catch (error) {
                console.error('Error in assignExistingKittenToBreed:', error);
                showMessage('Ошибка при выборе котенка', 'error');
            }
        }

        async function assignKittenToBreed(catId, breedTitle, element) {
            try {
                // Добавляем индикатор загрузки
                element.style.opacity = '0.5';
                element.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading" style="margin: 0 auto;"></div></div>';
                
                // Загружаем данные кошки
                const cats = await getCatsFromStorage();
                const cat = cats.find(c => c.id == catId);
                
                if (!cat) {
                    throw new Error('Котенок не найден');
                }
                
                // Обновляем породу у кошки
                cat.breed = breedTitle;
                await updateCatInStorage(catId, cat);
                
                // Закрываем модальное окно
                const modal = document.querySelector('[style*="position: fixed"]');
                if (modal) modal.remove();
                
                showMessage(`Котенок "${cat.name}" привязан к породе "${breedTitle}"`, 'success');
                
                // Обновляем список котят
                const breedId = document.getElementById('currentBreedId').value;
                await loadBreedKittens(breedId);
                
                // Обновляем общий список кошек
                await loadCatsList();
                
            } catch (error) {
                console.error('Error assigning kitten:', error);
                showMessage('Ошибка при привязке котенка', 'error');
                
                // Восстанавливаем элемент
                if (element) {
                    element.style.opacity = '1';
                }
            }
        }

        // Загрузка котят для породы
        async function loadBreedKittens(breedId) {
            try {
                const breedTitle = breedId === 'chinchilla' ? 'Золотая Шиншилла' : 
                                  breedId === 'devon' ? 'Девон-рекс' : 'Манчкин';
                
                const cats = await getCatsFromStorage();
                const breedCats = cats.filter(cat => 
                    cat.breed && cat.breed.toLowerCase().includes(breedTitle.toLowerCase())
                );
                
                const kittensContainer = document.getElementById('breedKittensContainer');
                kittensContainer.innerHTML = '';
                
                if (breedCats.length === 0) {
                    kittensContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #7f8c8d; border: 2px dashed #ddd; border-radius: 10px;">
                            <i class="fas fa-cat" style="font-size: 48px; margin-bottom: 20px; display: block; color: #C8A97E;"></i>
                            <h4>Нет добавленных котят</h4>
                            <p style="margin-bottom: 20px;">Добавьте котят этой породы, чтобы они отображались на странице</p>
                            <div style="display: flex; flex-direction: column; gap: 10px; max-width: 300px; margin: 0 auto;">
                                <button class="btn btn-success" onclick="addKittenFromBreedPage()">
                                    <i class="fas fa-plus"></i> Добавить нового котенка
                                </button>
                                <button class="btn btn-primary" onclick="assignExistingKittenToBreed()">
                                    <i class="fas fa-link"></i> Привязать существующего котенка
                                </button>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                breedCats.forEach((cat, index) => {
                    const statusBadge = getStatusBadge(cat.status);
                    const kittenCard = document.createElement('div');
                    kittenCard.className = 'kitten-card-editor';
                    kittenCard.innerHTML = `
                        <div class="kitten-editor-header">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                ${cat.images && cat.images.length > 0 ? 
                                    `<img src="${cat.images[0]}" alt="${cat.name}" style="width: 80px; height: 80px; border-radius: 10px; object-fit: cover;">` : 
                                    `<div style="width: 80px; height: 80px; border-radius: 10px; background: #f8f9fa; display: flex; align-items: center; justify-content: center; border: 2px dashed #C8A97E;">
                                        <i class="fas fa-cat" style="color: #C8A97E; font-size: 32px;"></i>
                                    </div>`
                                }
                                <div style="flex: 1;">
                                    <h4 style="margin: 0 0 5px 0; color: #2c3e50; font-size: 18px;">${cat.name}</h4>
                                    <div style="display: flex; gap: 10px; font-size: 14px; color: #666; flex-wrap: wrap;">
                                        <span><strong>Порода:</strong> ${cat.breed}</span>
                                        <span>•</span>
                                        <span><strong>Пол:</strong> ${cat.gender}</span>
                                        <span>•</span>
                                        <span><strong>Окрас:</strong> ${cat.color}</span>
                                        ${cat.age ? `<span>•</span><span><strong>Возраст:</strong> ${cat.age} мес.</span>` : ''}
                                        ${cat.price ? `<span>•</span><span><strong>Цена:</strong> ${cat.price} руб.</span>` : ''}
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                ${statusBadge}
                                <div class="actions" style="display: flex; gap: 8px;">
                                    <button class="btn btn-primary action-btn" onclick="editBreedKitten('${cat.id}')" style="padding: 8px 12px;">
                                        <i class="fas fa-edit"></i> Редактировать
                                    </button>
                                    <button class="btn btn-danger action-btn" onclick="deleteBreedKitten('${cat.id}')" style="padding: 8px 12px;">
                                        <i class="fas fa-trash"></i> Удалить
                                    </button>
                                </div>
                            </div>
                        </div>
                        ${cat.description ? `
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                            <p style="margin: 0; color: #666; font-size: 14px; line-height: 1.4;">
                                <strong>Описание:</strong> ${cat.description}
                            </p>
                        </div>
                        ` : ''}
                    `;
                    kittensContainer.appendChild(kittenCard);
                });
                
                // Добавляем кнопку добавления новых котят в конец
                const addButtonsContainer = document.createElement('div');
                addButtonsContainer.style.marginTop = '30px';
                addButtonsContainer.style.textAlign = 'center';
                addButtonsContainer.style.padding = '20px';
                addButtonsContainer.style.borderTop = '2px solid #f1f1f1';
                addButtonsContainer.innerHTML = `
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="btn btn-success" onclick="addKittenFromBreedPage()" style="padding: 12px 20px;">
                            <i class="fas fa-plus"></i> Добавить нового котенка
                        </button>
                        <button class="btn btn-primary" onclick="assignExistingKittenToBreed()" style="padding: 12px 20px;">
                            <i class="fas fa-link"></i> Привязать существующего котенка
                        </button>
                    </div>
                `;
                kittensContainer.appendChild(addButtonsContainer);
                
            } catch (error) {
                console.error('Error loading breed kittens:', error);
                const kittensContainer = document.getElementById('breedKittensContainer');
                kittensContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #e74c3c;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px; display: block;"></i>
                        <h4>Ошибка загрузки котят</h4>
                        <p>${error.message}</p>
                        <button class="btn btn-primary" onclick="loadBreedKittens('${breedId}')" style="margin-top: 15px;">
                            <i class="fas fa-redo"></i> Попробовать снова
                        </button>
                    </div>
                `;
            }
        }

        // Редактирование котенка в контексте породы
        async function editBreedKitten(catId) {
            try {
                const cats = await getCatsFromStorage();
                const cat = cats.find(c => c.id == catId);
                
                if (!cat) {
                    showMessage('Котенок не найден', 'error');
                    return;
                }
                
                editingCatId = catId;
                
                // Заполняем форму данными
                document.getElementById('catName').value = cat.name || '';
                document.getElementById('catBreed').value = cat.breed || '';
                document.getElementById('catGender').value = cat.gender || '';
                document.getElementById('catStatus').value = cat.status || '';
                document.getElementById('catColor').value = cat.color || '';
                document.getElementById('catAge').value = cat.age || '';
                document.getElementById('catPrice').value = cat.price || '';
                document.getElementById('catLitter').value = cat.litter || '';
                document.getElementById('catParents').value = cat.parents || '';
                document.getElementById('catDescription').value = cat.description || '';
                document.getElementById('catCharacteristics').value = cat.characteristics || '';
                document.getElementById('editingCatId').value = catId;
                
                // Загружаем изображения
                const uploadedImagesContainer = document.getElementById('catUploadedImages');
                uploadedImagesContainer.innerHTML = '';
                currentCatImages = [];
                
                if (cat.images && cat.images.length > 0) {
                    cat.images.forEach((imageUrl, index) => {
                        const imageData = {
                            id: `existing_${index}`,
                            url: imageUrl
                        };
                        
                        currentCatImages.push(imageData);
                        
                        const imageElement = document.createElement('div');
                        imageElement.className = 'uploaded-image';
                        imageElement.innerHTML = `
                            <img src="${imageUrl}" alt="Cat image ${index + 1}">
                            <div class="remove-image" onclick="removeCatImage('${imageData.id}')">
                                <i class="fas fa-times"></i>
                            </div>
                        `;
                        
                        uploadedImagesContainer.appendChild(imageElement);
                    });
                }
                
                // Меняем текст кнопки
                document.getElementById('catSubmitText').textContent = 'Обновить кошку';
                document.getElementById('cancelEdit').style.display = 'inline-block';
                
                // Переключаемся на форму редактирования
                document.querySelector('[data-tab="cats"]').click();
                document.querySelector('[data-subtab="add-cat"]').click();
                
                // Прокручиваем к форме
                document.getElementById('add-cat').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Error loading cat:', error);
                showMessage('Ошибка загрузки данных кошки', 'error');
            }
        }

        // Удаление котенка из породы
        async function deleteBreedKitten(catId) {
            if (!confirm('Вы уверены, что хотите удалить этого котенка? Это действие нельзя отменить.')) {
                return;
            }
            
            try {
                await deleteCatFromStorage(catId);
                showMessage('Котенок успешно удален!', 'success');
                
                // Обновляем список котят
                const breedId = document.getElementById('currentBreedId').value;
                await loadBreedKittens(breedId);
                
                // Обновляем список кошек
                await loadCatsList();
                
            } catch (error) {
                console.error('Error deleting cat:', error);
                showMessage('Ошибка удаления котенка', 'error');
            }
        }

        

        // ========== ОСНОВНЫЕ ФУНКЦИИ ДЛЯ КОШЕК ==========

        // Получение кошек из localStorage
        async function getCatsFromStorage() {
            try {
                const cats = JSON.parse(localStorage.getItem('petochania_cats') || '[]');
                
                // Проверяем и очищаем дубликаты
                const uniqueCats = [];
                const seenIds = new Set();
                
                cats.forEach(cat => {
                    if (!cat.id) {
                        // Если у кошки нет ID, генерируем новый
                        cat.id = 'cat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    }
                    
                    if (!seenIds.has(cat.id)) {
                        seenIds.add(cat.id);
                        uniqueCats.push(cat);
                    }
                });
                
                // Если были дубликаты, сохраняем очищенный список
                if (uniqueCats.length !== cats.length) {
                    localStorage.setItem('petochania_cats', JSON.stringify(uniqueCats));
                }
                
                return uniqueCats;
            } catch (error) {
                console.error('Error getting cats from storage:', error);
                return [];
            }
        }

        // Сохранение кошки в localStorage
        async function saveCatToStorage(catData) {
            try {
                let cats = await getCatsFromStorage();
                
                if (catData.id && catData.id !== '') {
                    // Обновляем существующую кошку
                    const index = cats.findIndex(c => c.id == catData.id);
                    if (index !== -1) {
                        cats[index] = { ...cats[index], ...catData };
                        console.log('Коша обновлена в localStorage');
                    } else {
                        cats.push(catData);
                        console.log('Кошка добавлена в localStorage (редактирование)');
                    }
                } else {
                    // Добавляем новую кошку
                    catData.id = 'cat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    catData.createdAt = new Date().toISOString();
                    cats.push(catData);
                    console.log('Новая кошка добавлена в localStorage');
                }
                
                // Сохраняем
                localStorage.setItem('petochania_cats', JSON.stringify(cats));
                
                // Обновляем общее хранилище
                const syncData = JSON.parse(localStorage.getItem('petochania_sync_data') || '{}');
                syncData.cats = cats;
                localStorage.setItem('petochania_sync_data', JSON.stringify(syncData));
                
                // Триггерим событие для страниц пород
                localStorage.setItem('cats_updated', Date.now().toString());
                
                const updateEvent = new CustomEvent('dataSyncUpdate', {
                    detail: { source: 'admin-panel', timestamp: new Date().toISOString() }
                });
                window.dispatchEvent(updateEvent);
                
                return catData;
            } catch (error) {
                console.error('Error saving cat to storage:', error);
                throw error;
            }
        }

        // Обновление кошки в localStorage
        async function updateCatInStorage(catId, catData) {
            try {
                let cats = await getCatsFromStorage();
                const index = cats.findIndex(c => c.id == catId);
                
                if (index !== -1) {
                    cats[index] = { ...cats[index], ...catData };
                    localStorage.setItem('petochania_cats', JSON.stringify(cats));
                    return cats[index];
                } else {
                    throw new Error('Кошка не найдена');
                }
            } catch (error) {
                console.error('Error updating cat in storage:', error);
                throw error;
            }
        }

        // Удаление кошки из localStorage
        async function deleteCatFromStorage(catId) {
            try {
                let cats = await getCatsFromStorage();
                const filteredCats = cats.filter(c => c.id != catId);
                
                localStorage.setItem('petochania_cats', JSON.stringify(filteredCats));
                
                // Обновляем общее хранилище
                const syncData = JSON.parse(localStorage.getItem('petochania_sync_data') || '{}');
                syncData.cats = filteredCats;
                localStorage.setItem('petochania_sync_data', JSON.stringify(syncData));
                
                // Триггерим событие
                localStorage.setItem('cats_updated', Date.now().toString());
                
                const updateEvent = new CustomEvent('dataSyncUpdate', {
                    detail: { source: 'admin-delete', timestamp: new Date().toISOString() }
                });
                window.dispatchEvent(updateEvent);
                
                return true;
            } catch (error) {
                console.error('Error deleting cat from storage:', error);
                throw error;
            }
        }

        // Сохранение породы
        async function saveBreedPage() {
            const breedId = document.getElementById('currentBreedId').value;
            const title = document.getElementById('breedPageTitle').value;
            const description = document.getElementById('breedPageDescription').value;
            const heroDescription = document.getElementById('breedHeroDescription').value;
            
            if (!breedId || !title || !description || !heroDescription) {
                showMessage('Пожалуйста, заполните обязательные поля', 'error');
                return;
            }
            
            const submitText = document.getElementById('breedPageSubmitText');
            const submitLoading = document.getElementById('breedPageSubmitLoading');
            
            try {
                submitText.style.display = 'none';
                showLoading(submitLoading);
                
                // Подготавливаем данные
                const breedData = {
                    title,
                    description,
                    heroDescription,
                    origin: document.getElementById('breedOrigin').value,
                    weight: document.getElementById('breedWeight').value,
                    lifespan: document.getElementById('breedLifespan').value,
                    temperament: document.getElementById('breedTemperament').value,
                    characteristics: document.getElementById('breedCharacteristics').value.split(',').map(c => c.trim()).filter(c => c),
                    lastUpdated: new Date().toISOString()
                };
                
                // Если есть новое изображение, конвертируем в base64
                if (currentBreedMainImage) {
                    const base64Image = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            resolve(e.target.result);
                        };
                        reader.readAsDataURL(currentBreedMainImage);
                    });
                    
                    breedData.mainImage = base64Image;
                } else {
                    // Сохраняем текущее изображение если есть
                    const preview = document.getElementById('breedMainImagePreview');
                    const existingImg = preview.querySelector('img');
                    if (existingImg && existingImg.src) {
                        breedData.mainImage = existingImg.src;
                    }
                }
                
                // Сохраняем в localStorage
                const breedPages = JSON.parse(localStorage.getItem('petochania_breedPages') || '{}');
                breedPages[breedId] = breedData;
                localStorage.setItem('petochania_breedPages', JSON.stringify(breedPages));
                localStorage.setItem('breedPages', JSON.stringify(breedPages));
                
                // Обновляем общее хранилище
                const syncData = JSON.parse(localStorage.getItem('petochania_sync_data') || '{}');
                syncData.breedPages = breedPages;
                localStorage.setItem('petochania_sync_data', JSON.stringify(syncData));
                
                // Триггерим событие
                localStorage.setItem('breedPages_updated', Date.now().toString());
                
                const updateEvent = new CustomEvent('dataSyncUpdate', {
                    detail: { source: 'admin-panel' }
                });
                window.dispatchEvent(updateEvent);
                
                showMessage('Страница породы успешно обновлена!', 'success');
                
                // Обновляем список страниц
                await updateBreedPagesList();
                
                // Обновляем список котят
                await loadBreedKittens(breedId);
                
                // Обновляем дашборд
                await updateDashboard();
                
            } catch (error) {
                console.error('Error saving breed page:', error);
                showMessage('Ошибка при сохранении: ' + error.message, 'error');
            } finally {
                submitText.style.display = 'inline';
                hideLoading(submitLoading);
            }
        }

        // Сохранение кошки
        async function saveCat() {
            const name = document.getElementById('catName').value;
            const breed = document.getElementById('catBreed').value;
            const gender = document.getElementById('catGender').value;
            const status = document.getElementById('catStatus').value;
            const color = document.getElementById('catColor').value;
            const editingId = document.getElementById('editingCatId').value;
            
            if (!name || !breed || !gender || !status || !color) {
                showMessage('Пожалуйста, заполните обязательные поля', 'error');
                return;
            }
            
            const submitText = document.getElementById('catSubmitText');
            const submitLoading = document.getElementById('catSubmitLoading');
            
            try {
                submitText.style.display = 'none';
                showLoading(submitLoading);
                
                // Подготавливаем данные
                const catData = {
                    name,
                    breed,
                    gender,
                    status,
                    color,
                    age: document.getElementById('catAge').value || '',
                    price: document.getElementById('catPrice').value || '',
                    litter: document.getElementById('catLitter').value || '',
                    parents: document.getElementById('catParents').value || '',
                    description: document.getElementById('catDescription').value || '',
                    characteristics: document.getElementById('catCharacteristics').value || '',
                    updatedAt: new Date().toISOString()
                };
                
                // Конвертируем изображения в base64
                const base64Images = [];
                
                for (const imageData of currentCatImages) {
                    if (imageData.url.startsWith('data:image/')) {
                        // Уже base64
                        base64Images.push(imageData.url);
                    } else if (imageData.file) {
                        // Файл, конвертируем в base64
                        const base64Data = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                resolve(e.target.result);
                            };
                            reader.readAsDataURL(imageData.file);
                        });
                        base64Images.push(base64Data);
                    } else {
                        // Существующее изображение (URL)
                        base64Images.push(imageData.url);
                    }
                }
                
                catData.images = base64Images;
                
                if (editingId) {
                    catData.id = editingId;
                }
                
                // Сохраняем локально
                const savedCat = await saveCatToStorage(catData);
                
                // Пытаемся сохранить на сервер
                try {
                    const token = localStorage.getItem('petochania_authToken');
                    const endpoint = editingId ? `/api/cats/${catData.id}` : '/api/cats';
                    const method = editingId ? 'PUT' : 'POST';
                    
                    const response = await fetch(`${API_BASE}${endpoint}`, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(savedCat)
                    });
                    
                    if (!response.ok) {
                        console.warn('Не удалось сохранить на сервер, но локально сохранено');
                    }
                } catch (serverError) {
                    console.warn('Ошибка соединения с сервером:', serverError);
                }
                
                const message = editingId ? 'Котенок успешно обновлен!' : 'Котенок успешно добавлен!';
                showMessage(message, 'success');
                
                // Обновляем все списки
                await loadCatsList();
                await updateBreedPagesList();
                
                // Проверяем, связана ли кошка с текущей редактируемой породой
                const currentBreedId = document.getElementById('currentBreedId').value;
                if (currentBreedId && breed.toLowerCase().includes(getBreedNameById(currentBreedId).toLowerCase())) {
                    await loadBreedKittens(currentBreedId);
                }
                
                // Сбрасываем форму
                resetCatForm();
                
                // Обновляем дашборд
                await updateDashboard();
                
            } catch (error) {
                console.error('Error saving cat:', error);
                showMessage('Ошибка при сохранении кошки: ' + error.message, 'error');
            } finally {
                submitText.style.display = 'inline';
                hideLoading(submitLoading);
            }
        }

        // Функция для получения названия породы по ID
        function getBreedNameById(breedId) {
            const breedMap = {
                'chinchilla': 'Золотая Шиншилла',
                'devon': 'Девон-рекс', 
                'munchkin': 'Манчкин'
            };
            return breedMap[breedId] || '';
        }

        // Загрузка списка кошек
        async function loadCatsList() {
            try {
                console.log('Загрузка списка кошек...');
                
                const cats = await getCatsFromStorage();
                const tbody = document.getElementById('catsTableBody');
                
                if (!cats || cats.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; color: #7f8c8d;">
                                <i class="fas fa-cat" style="font-size: 48px; display: block; margin-bottom: 10px;"></i>
                                Нет добавленных кошек
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = '';
                
                // Сортируем по дате добавления (новые сверху)
                cats.sort((a, b) => {
                    const dateA = new Date(a.createdAt || 0);
                    const dateB = new Date(b.createdAt || 0);
                    return dateB - dateA;
                });
                
                cats.forEach(cat => {
                    const statusBadge = getStatusBadge(cat.status);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                ${cat.images && cat.images.length > 0 ? 
                                    `<img src="${cat.images[0]}" alt="${cat.name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : 
                                    `<div style="width: 40px; height: 40px; border-radius: 50%; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-cat" style="color: #C8A97E;"></i>
                                    </div>`
                                }
                                <strong>${cat.name || 'Без имени'}</strong>
                            </div>
                        </td>
                        <td>${cat.breed || 'Не указана'}</td>
                        <td>${cat.gender || 'Не указан'}</td>
                        <td>${statusBadge}</td>
                        <td>${cat.createdAt ? new Date(cat.createdAt).toLocaleDateString('ru-RU') : '-'}</td>
                        <td>
                            <div class="actions">
                                <button class="btn btn-primary action-btn" onclick="editCat('${cat.id}')">
                                    <i class="fas fa-edit"></i> Редактировать
                                </button>
                                <button class="btn btn-danger action-btn" onclick="deleteCat('${cat.id}')">
                                    <i class="fas fa-trash"></i> Удалить
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                console.log('Список кошек отображен:', cats.length, 'записей');
                
            } catch (error) {
                console.error('Error loading cats:', error);
                const tbody = document.getElementById('catsTableBody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #e74c3c;">
                            <i class="fas fa-exclamation-triangle"></i>
                            Ошибка загрузки данных: ${error.message}
                        </td>
                    </tr>
                `;
            }
        }

        // Фильтрация кошек
        async function filterCats(searchTerm) {
            try {
                const cats = await getCatsFromStorage();
                const tbody = document.getElementById('catsTableBody');
                
                if (!searchTerm) {
                    loadCatsList();
                    return;
                }
                
                const filteredCats = cats.filter(cat => 
                    (cat.name && cat.name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (cat.breed && cat.breed.toLowerCase().includes(searchTerm.toLowerCase()))
                );
                
                if (filteredCats.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; color: #7f8c8d;">
                                Кошки не найдены
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = '';
                
                filteredCats.forEach(cat => {
                    const statusBadge = getStatusBadge(cat.status);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                ${cat.images && cat.images.length > 0 ? 
                                    `<img src="${cat.images[0]}" alt="${cat.name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : 
                                    `<div style="width: 40px; height: 40px; border-radius: 50%; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-cat" style="color: #C8A97E;"></i>
                                    </div>`
                                }
                                <strong>${cat.name}</strong>
                            </div>
                        </td>
                        <td>${cat.breed}</td>
                        <td>${cat.gender}</td>
                        <td>${statusBadge}</td>
                        <td>${cat.createdAt ? new Date(cat.createdAt).toLocaleDateString('ru-RU') : '-'}</td>
                        <td>
                            <div class="actions">
                                <button class="btn btn-primary action-btn" onclick="editCat('${cat.id}')">
                                    <i class="fas fa-edit"></i> Редактировать
                                </button>
                                <button class="btn btn-danger action-btn" onclick="deleteCat('${cat.id}')">
                                    <i class="fas fa-trash"></i> Удалить
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error filtering cats:', error);
            }
        }

        // Редактирование кошки из списка
        async function editCat(catId) {
            try {
                const cats = await getCatsFromStorage();
                const cat = cats.find(c => c.id == catId);
                
                if (!cat) {
                    showMessage('Кошка не найдена', 'error');
                    return;
                }
                
                editingCatId = catId;
                
                // Заполняем форму данными
                document.getElementById('catName').value = cat.name || '';
                document.getElementById('catBreed').value = cat.breed || '';
                document.getElementById('catGender').value = cat.gender || '';
                document.getElementById('catStatus').value = cat.status || '';
                document.getElementById('catColor').value = cat.color || '';
                document.getElementById('catAge').value = cat.age || '';
                document.getElementById('catPrice').value = cat.price || '';
                document.getElementById('catLitter').value = cat.litter || '';
                document.getElementById('catParents').value = cat.parents || '';
                document.getElementById('catDescription').value = cat.description || '';
                document.getElementById('catCharacteristics').value = cat.characteristics || '';
                document.getElementById('editingCatId').value = catId;
                
                // Загружаем изображения
                const uploadedImagesContainer = document.getElementById('catUploadedImages');
                uploadedImagesContainer.innerHTML = '';
                currentCatImages = [];
                
                if (cat.images && cat.images.length > 0) {
                    cat.images.forEach((imageUrl, index) => {
                        const imageData = {
                            id: `existing_${index}`,
                            url: imageUrl
                        };
                        
                        currentCatImages.push(imageData);
                        
                        const imageElement = document.createElement('div');
                        imageElement.className = 'uploaded-image';
                        imageElement.innerHTML = `
                            <img src="${imageUrl}" alt="Cat image ${index + 1}">
                            <div class="remove-image" onclick="removeCatImage('${imageData.id}')">
                                <i class="fas fa-times"></i>
                            </div>
                        `;
                        
                        uploadedImagesContainer.appendChild(imageElement);
                    });
                }
                
                // Меняем текст кнопки
                document.getElementById('catSubmitText').textContent = 'Обновить кошку';
                document.getElementById('cancelEdit').style.display = 'inline-block';
                
                // Переключаемся на форму редактирования
                document.querySelector('[data-subtab="add-cat"]').click();
                
            } catch (error) {
                console.error('Error loading cat for edit:', error);
                showMessage('Ошибка загрузки данных кошки', 'error');
            }
        }

        // Удаление кошки
        async function deleteCat(catId) {
            if (!confirm('Вы уверены, что хотите удалить эту кошку? Это действие нельзя отменить.')) {
                return;
            }
            
            try {
                // Удаляем локально
                await deleteCatFromStorage(catId);
                
                // Пытаемся удалить с сервера
                try {
                    const token = localStorage.getItem('petochania_authToken');
                    const response = await fetch(`${API_BASE}/cats/${catId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (!response.ok) {
                        console.warn('Не удалось удалить с сервера, но локально удалено');
                    }
                } catch (serverError) {
                    console.warn('Ошибка соединения с сервером:', serverError);
                }
                
                showMessage('Кошка успешно удалена!', 'success');
                
                // Обновляем список кошек
                await loadCatsList();
                
                // Обновляем список пород если редактировали из контекста породы
                const breedId = document.getElementById('currentBreedId').value;
                if (breedId) {
                    await loadBreedKittens(breedId);
                    await updateBreedPagesList();
                }
                
                // Обновляем дашборд
                await updateDashboard();
                
            } catch (error) {
                console.error('Error deleting cat:', error);
                showMessage('Ошибка удаления кошки', 'error');
            }
        }

        // Обновление списка страниц пород
        async function updateBreedPagesList() {
            try {
                const breedPages = JSON.parse(localStorage.getItem('petochania_breedPages') || '{}');
                const cats = await getCatsFromStorage();
                const tbody = document.getElementById('breedPagesTableBody');
                
                tbody.innerHTML = '';
                
                const breeds = [
                    { id: 'chinchilla', name: 'Золотая Шиншилла', url: '/chinchilla.html' },
                    { id: 'devon', name: 'Девон-рекс', url: '/devon.html' },
                    { id: 'munchkin', name: 'Манчкин', url: '/munchkin.html' }
                ];
                
                breeds.forEach(breed => {
                    const breedData = breedPages[breed.id];
                    const lastUpdated = breedData?.lastUpdated ? 
                        new Date(breedData.lastUpdated).toLocaleDateString('ru-RU') : 'Не обновлялась';
                    
                    // Считаем количество котят этой породы
                    const breedCatsCount = cats.filter(cat => 
                        cat.breed && cat.breed.toLowerCase().includes(breed.name.toLowerCase())
                    ).length;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${breedData?.title || breed.name}</td>
                        <td>${breed.url}</td>
                        <td>${lastUpdated}</td>
                        <td>${breedCatsCount}</td>
                        <td>
                            <div class="actions">
                                <button class="btn btn-primary action-btn" onclick="editBreedPage('${breed.id}')">
                                    <i class="fas fa-edit"></i> Редактировать
                                </button>
                                <button class="btn btn-success action-btn" onclick="addKittenToBreed('${breed.id}', '${breed.name}')">
                                    <i class="fas fa-plus"></i> Добавить котенка
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error updating breed pages list:', error);
                const tbody = document.getElementById('breedPagesTableBody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: #e74c3c;">
                            <i class="fas fa-exclamation-triangle"></i>
                            Ошибка загрузки данных
                        </td>
                    </tr>
                `;
            }
        }

        // Добавление котенка к породе из списка пород
        function addKittenToBreed(breedId, breedTitle) {
            // Автоматически устанавливаем породу
            document.getElementById('catBreed').value = breedTitle;
            
            // Переходим к форме добавления кошки
            document.querySelector('[data-tab="cats"]').click();
            document.querySelector('[data-subtab="add-cat"]').click();
            
            // Прокручиваем к форме
            document.getElementById('add-cat').scrollIntoView({ behavior: 'smooth' });
            
            showMessage(`Порода автоматически установлена: "${breedTitle}". Теперь заполните информацию о котенке`, 'info');
        }

        // Предпросмотр страницы
        function previewBreedPage() {
            const breedId = document.getElementById('currentBreedId').value;
            if (breedId) {
                const breedTitle = document.getElementById('breedPageTitle').value;
                const breedData = {
                    title: breedTitle,
                    heroDescription: document.getElementById('breedHeroDescription').value,
                    description: document.getElementById('breedPageDescription').value,
                    origin: document.getElementById('breedOrigin').value,
                    weight: document.getElementById('breedWeight').value,
                    lifespan: document.getElementById('breedLifespan').value,
                    temperament: document.getElementById('breedTemperament').value,
                    characteristics: document.getElementById('breedCharacteristics').value.split(',').map(c => c.trim()).filter(c => c)
                };
                
                // Сохраняем данные для предпросмотра
                localStorage.setItem('breed_preview_data', JSON.stringify(breedData));
                
                window.open(`${breedId}.html?preview=true`, '_blank');
            }
        }

        // Получение данных по умолчанию для породы
        function getDefaultBreedData(breedId) {
            const defaults = {
                'chinchilla': {
                    title: 'Золотая Шиншилла',
                    heroDescription: 'Аристократичные британцы с роскошной золотистой шерстью и королевским характером',
                    description: 'Золотые шиншиллы — одна из самых красивых и редких пород кошек. Их шерсть имеет уникальный золотистый оттенок с затемнениями на кончиках, создавая эффект сияния. Эти аристократичные кошки обладают спокойным и уравновешенным характером, идеально подходят для жизни в семье.',
                    origin: 'Великобритания',
                    weight: '4-6 кг',
                    lifespan: '12-15 лет',
                    temperament: 'Спокойный, нежный',
                    characteristics: ['Любопытный', 'Дружелюбный', 'Элегантный', 'Спокойный', 'Независимый']
                },
                'devon': {
                    title: 'Девон-рекс',
                    heroDescription: 'Энергичные и любвеобильные кошки с инопланетной внешностью и собачьим характером',
                    description: 'Девон-рекс — порода домашних кошек, появившаяся в Великобритании в 1960-х годах. Эти кошки отличаются уникальной волнистой шерстью, большими ушами и выразительными глазами. Девон-рексы очень социальные и преданные кошки, которые любят быть в центре внимания.',
                    origin: 'Великобритания',
                    weight: '3-4.5 кг',
                    lifespan: '9-15 лет',
                    temperament: 'Активный, игривый',
                    characteristics: ['Ласковый', 'Игривый', 'Умный', 'Общительный', 'Энергичный']
                },
                'munchkin': {
                    title: 'Манчкин',
                    heroDescription: 'Очаровательные коротколапые кошки с уникальной внешностью и дружелюбным нравом',
                    description: 'Манчкины — уникальная порода кошек с короткими лапками, появившаяся в результате естественной генетической мутации. Несмотря на короткие конечности, эти кошки очень подвижны и активны. Манчкины известны своим дружелюбным и общительным характером.',
                    origin: 'США',
                    weight: '3-4 кг',
                    lifespan: '12-15 лет',
                    temperament: 'Дружелюбный, любопытный',
                    characteristics: ['Величественная', 'Умная', 'Любопытная', 'Дружелюбная', 'Общительная']
                }
            };
            
            return defaults[breedId] || {};
        }

        // Глобальный обработчик логина (используется и через addEventListener, и через onclick)
        async function handleLoginClick() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const messageEl = document.getElementById('loginMessage');
                const loginText = document.getElementById('loginText');
                const loginLoading = document.getElementById('loginLoading');
                
                if (!username || !password) {
                    messageEl.textContent = 'Пожалуйста, заполните все поля';
                    return;
                }
                
                try {
                    loginText.style.display = 'none';
                    showLoading(loginLoading);
                    messageEl.textContent = '';

                // 1) Локальный безопасный вход без обращения к бэкенду.
                // Это гарантирует работу логина даже если API недоступно,
                // критично для GitHub Pages и других статических хостингов.
                if (username === 'admin' && (password === 'admin' || password === 'admin123')) {
                    authToken = 'token_' + Date.now();
                    localStorage.setItem('petochania_authToken', authToken);
                    currentUser = { username: 'admin', role: 'admin' };
                    localStorage.setItem('petochania_currentUser', JSON.stringify(currentUser));
                    
                    showAdminPanel();
                    showMessage('Успешный вход в систему!', 'success');
                    return;
                }
                
                // 2) Стандартный путь через apiService (Express / GitHub backend)
                const response = await apiService.login(username, password);
                
                if (response && response.success) {
                    showAdminPanel();
                    showMessage('Успешный вход в систему!', 'success');
                } else {
                    throw new Error((response && response.error) || 'Неверный логин или пароль');
                }
                } catch (error) {
                    console.error('Login error handler:', error);
                    messageEl.textContent = 'Ошибка входа: ' + (error.message || 'Неизвестная ошибка');
                } finally {
                    loginText.style.display = 'inline';
                    hideLoading(loginLoading);
                }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            // Проверяем авторизацию
            if (authToken) {
                try {
                    showAdminPanel();
                } catch (error) {
                    console.log('Invalid token, showing login page');
                    authToken = '';
                    localStorage.removeItem('petochania_authToken');
                }
            }

            // Login functionality (дублируем на случай, если отключен inline-обработчик)
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                loginBtn.addEventListener('click', handleLoginClick);
            }

            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('Вы уверены, что хотите выйти?')) {
                    authToken = '';
                    localStorage.removeItem('petochania_authToken');
                    window.location.reload();
                }
            });

            // Navigation tabs
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (this.id === 'logoutBtn') return;
                    
                    // Update active nav link
                    document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding tab
                    const tabId = this.getAttribute('data-tab');
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                    
                    // Update page title
                    const pageTitles = {
                        'dashboard': 'Дашборд',
                        'cats': 'Кошки',
                        'breed-pages': 'Страницы пород',
                        'gallery': 'Галерея',
                        'faq': 'FAQ',
                        'reviews': 'Отзывы',
                        'videos': 'Видео',
                        'settings': 'Настройки'
                    };
                    document.getElementById('pageTitle').textContent = pageTitles[tabId] || this.querySelector('span').textContent;
                    
                    // Load data for specific tabs
                    if (tabId === 'cats') {
                        loadCatsList();
                    } else if (tabId === 'breed-pages') {
                        updateBreedPagesList();
                    } else if (tabId === 'dashboard') {
                        updateDashboard();
                    }
                });
            });
            
            // Sub-tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const subtabId = this.getAttribute('data-subtab');
                    const parentTabs = this.closest('.tabs');
                    
                    // Update active sub-tab
                    parentTabs.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding sub-tab content
                    const parentContent = this.closest('.content-section');
                    parentContent.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    parentContent.querySelector('#' + subtabId).classList.add('active');
                });
            });
            
            // Quick action buttons
            document.querySelectorAll('[data-tab]').forEach(btn => {
                if (btn.classList.contains('btn')) {
                    btn.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        
                        // Update active nav link
                        document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
                        document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
                        
                        // Show corresponding tab
                        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                        document.getElementById(tabId).classList.add('active');
                        
                        // Update page title
                        const pageTitles = {
                            'dashboard': 'Дашборд',
                            'cats': 'Кошки',
                            'breed-pages': 'Страницы пород',
                            'gallery': 'Галерея',
                            'faq': 'FAQ',
                            'reviews': 'Отзывы',
                            'videos': 'Видео',
                            'settings': 'Настройки'
                        };
                        document.getElementById('pageTitle').textContent = pageTitles[tabId] || document.querySelector(`[data-tab="${tabId}"] span`).textContent;
                        
                        // Load data for specific tabs
                        if (tabId === 'cats') {
                            loadCatsList();
                        } else if (tabId === 'breed-pages') {
                            updateBreedPagesList();
                        }
                    });
                }
            });
            
            // Initialize forms
            initBreedPagesForm();
            initCatsForm();
            
            // Инициализируем backend перед загрузкой данных
            await initBackend();
            
            // Синхронизируем данные из Gist если backend инициализирован или есть Gist ID
            const gistIdFromStorage = localStorage.getItem('petochania_gist_id');
            const gistIdFromBackend = window.githubSyncBackend?.gistId;
            const backendInitialized = backend && typeof backend === 'object' && backend.initialized;
            
            const shouldSync = backendInitialized || gistIdFromBackend || gistIdFromStorage;
            
            console.log('🔍 Проверка синхронизации:', {
                backendInitialized,
                gistIdFromBackend,
                gistIdFromStorage,
                shouldSync
            });
            
            if (shouldSync) {
                try {
                    console.log('🔄 Синхронизация данных из GitHub Gist...');
                    // Используем githubSyncBackend напрямую если он доступен
                    const syncBackend = window.githubSyncBackend || backend;
                    if (syncBackend && typeof syncBackend.loadData === 'function') {
                        const gistData = await syncBackend.loadData();
                        if (gistData) {
                            // Синхронизируем данные из Gist в localStorage
                            if (gistData.cats) {
                                localStorage.setItem('petochania_cats', JSON.stringify(gistData.cats));
                                console.log('✅ Кошки синхронизированы:', gistData.cats.length);
                            }
                            if (gistData.breedPages) {
                                localStorage.setItem('breedPages', JSON.stringify(gistData.breedPages));
                                localStorage.setItem('petochania_breedPages', JSON.stringify(gistData.breedPages));
                                console.log('✅ Страницы пород синхронизированы');
                            }
                            if (gistData.faq) {
                                localStorage.setItem('petochania_faq', JSON.stringify(gistData.faq));
                                console.log('✅ FAQ синхронизированы:', gistData.faq.length);
                            }
                            if (gistData.reviews) {
                                localStorage.setItem('petochania_reviews', JSON.stringify(gistData.reviews));
                                console.log('✅ Отзывы синхронизированы:', gistData.reviews.length);
                            }
                            if (gistData.videos) {
                                localStorage.setItem('petochania_videos', JSON.stringify(gistData.videos));
                                console.log('✅ Видео синхронизированы:', gistData.videos.length);
                            }
                            if (gistData.settings) {
                                localStorage.setItem('petochania_site_settings', JSON.stringify(gistData.settings));
                                console.log('✅ Настройки синхронизированы');
                            }
                            console.log('✅ Все данные успешно синхронизированы из GitHub Gist');
                            
                            // Принудительно обновляем интерфейс после синхронизации
                            if (authToken) {
                                console.log('🔄 Обновление интерфейса после синхронизации...');
                                await updateBreedPagesList();
                                await loadCatsList();
                                await updateDashboard();
                                console.log('✅ Интерфейс обновлен с синхронизированными данными');
                            }
                        }
                    } else {
                        console.warn('⚠️ Backend не поддерживает загрузку данных из Gist');
                    }
                } catch (error) {
                    console.error('❌ Не удалось синхронизировать данные из Gist:', error);
                }
            } else {
                console.warn('⚠️ Gist ID не найден, синхронизация пропущена');
            }
            
            // Загружаем настройки синхронизации после инициализации backend
            await loadSyncSettings();
            
            // Load initial data if already logged in
            if (authToken) {
                await updateBreedPagesList();
                await loadCatsList();
                await updateDashboard();

                // Загружаем начальные данные пород если их нет
                const breedPages = JSON.parse(localStorage.getItem('petochania_breedPages') || '{}');
                if (Object.keys(breedPages).length === 0) {
                    const defaultBreeds = {
                        'chinchilla': getDefaultBreedData('chinchilla'),
                        'devon': getDefaultBreedData('devon'),
                        'munchkin': getDefaultBreedData('munchkin')
                    };
                    localStorage.setItem('petochania_breedPages', JSON.stringify(defaultBreeds));
                    localStorage.setItem('breedPages', JSON.stringify(defaultBreeds));
                }
            }
        });

        async function showAdminPanel() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'flex';
        }

        // Dashboard functions
        async function updateDashboard() {
            try {
                const cats = await getCatsFromStorage();

                document.getElementById('totalCats').textContent = cats.length;
                document.getElementById('availableCats').textContent = cats.filter(cat => cat.status === 'ДОСТУПЕН').length;
                document.getElementById('totalQuestions').textContent = 0; // Пока нет FAQ
                document.getElementById('totalReviews').textContent = 0; // Пока нет отзывов

                // Update recent activity
                const recentActivity = document.getElementById('recentActivity');
                const activities = [];
                
                // Подсчитываем котят по породам
                const chinchillaCats = cats.filter(cat => cat.breed && cat.breed.includes('Золотая Шиншилла')).length;
                const devonCats = cats.filter(cat => cat.breed && cat.breed.includes('Девон-рекс')).length;
                const munchkinCats = cats.filter(cat => cat.breed && cat.breed.includes('Манчкин')).length;
                
                if (chinchillaCats > 0) {
                    activities.push(`${chinchillaCats} котят золотой шиншиллы`);
                }
                if (devonCats > 0) {
                    activities.push(`${devonCats} котят девон-рекса`);
                }
                if (munchkinCats > 0) {
                    activities.push(`${munchkinCats} котят манчкина`);
                }
                
                if (cats.length > 0) {
                    activities.push(`Всего ${cats.length} кошек в системе`);
                }

                if (activities.length > 0) {
                    recentActivity.innerHTML = activities.map(activity => 
                        `<p><i class="fas fa-check-circle" style="color: #27ae60;"></i> ${activity}</p>`
                    ).join('');
                } else {
                    recentActivity.innerHTML = `<p><i class="fas fa-info-circle" style="color: #3498db;"></i> Нет добавленных кошек. Начните с добавления первой кошки!</p>`;
                }
            } catch (error) {
                console.error('Error updating dashboard:', error);
                recentActivity.innerHTML = `<p><i class="fas fa-exclamation-triangle" style="color: #e74c3c;"></i> Ошибка загрузки данных</p>`;
            }
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // =================================== FAQ MANAGEMENT ===================================
let currentFaqData = null;

function initFaqManagement() {
    document.getElementById('addFaqBtn').addEventListener('click', function() {
        resetFaqForm();
        document.querySelector('[data-subtab="edit-faq"]').click();
    });

    document.getElementById('faqForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        await saveFaq();
    });

    document.getElementById('resetFaqForm').addEventListener('click', resetFaqForm);
    
    document.getElementById('deleteFaqBtn').addEventListener('click', async function() {
        const faqId = document.getElementById('editingFaqId').value;
        if (!faqId) return;
        
        const question = document.getElementById('faqQuestion').value;
        
        if (confirm(`Вы уверены, что хотите удалить вопрос "${question}"?`)) {
            await deleteFaq(faqId);
        }
    });

    document.getElementById('searchFaq').addEventListener('input', function(e) {
        filterFaq(e.target.value);
    });
}

async function loadFaqList() {
    try {
        const faqs = await getFaqFromStorage();
        const tbody = document.getElementById('faqTableBody');
        
        if (!faqs || faqs.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; color: #7f8c8d;">
                        <i class="fas fa-question-circle" style="font-size: 48px; display: block; margin-bottom: 10px;"></i>
                        Нет добавленных вопросов
                    </td>
                </tr>
            `;
            return;
        }
        
        tbody.innerHTML = '';
        
        // Sort by order
        faqs.sort((a, b) => (a.order || 999) - (b.order || 999));
        
        faqs.forEach((faq, index) => {
            const row = document.createElement('tr');
            const answerPreview = faq.answer.length > 100 ? 
                faq.answer.substring(0, 100) + '...' : faq.answer;
            
            row.innerHTML = `
                <td>${index + 1}</td>
                <td><strong>${faq.question}</strong></td>
                <td>${answerPreview}</td>
                <td>${faq.category || 'Общие'}</td>
                <td>${faq.order || 1}</td>
                <td>
                    <div class="actions">
                        <button class="btn btn-primary action-btn" onclick="editFaq('${faq.id}')">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                        <button class="btn btn-danger action-btn" onclick="deleteFaq('${faq.id}')">
                            <i class="fas fa-trash"></i> Удалить
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    } catch (error) {
        console.error('Error loading FAQ:', error);
    }
}

async function getFaqFromStorage() {
    try {
        const data = JSON.parse(localStorage.getItem('petochania_faq') || '[]');
        return Array.isArray(data) ? data : [];
    } catch (error) {
        console.error('Error getting FAQ from storage:', error);
        return [];
    }
}

async function saveFaqToStorage(faqData) {
    try {
        let faqs = await getFaqFromStorage();
        
        if (faqData.id) {
            const index = faqs.findIndex(f => f.id === faqData.id);
            if (index !== -1) {
                faqs[index] = { ...faqs[index], ...faqData, updatedAt: new Date().toISOString() };
            } else {
                faqData.id = 'faq_' + Date.now();
                faqData.createdAt = new Date().toISOString();
                faqs.push(faqData);
            }
        } else {
            faqData.id = 'faq_' + Date.now();
            faqData.createdAt = new Date().toISOString();
            faqs.push(faqData);
        }
        
        localStorage.setItem('petochania_faq', JSON.stringify(faqs));
        return faqData;
    } catch (error) {
        console.error('Error saving FAQ to storage:', error);
        throw error;
    }
}

async function saveFaq() {
    const question = document.getElementById('faqQuestion').value;
    const answer = document.getElementById('faqAnswer').value;
    const faqId = document.getElementById('editingFaqId').value;
    
    if (!question || !answer) {
        showMessage('Пожалуйста, заполните все обязательные поля', 'error');
        return;
    }
    
    const submitText = document.getElementById('faqSubmitText');
    const submitLoading = document.getElementById('faqSubmitLoading');
    
    try {
        submitText.style.display = 'none';
        showLoading(submitLoading);
        
        const faqData = {
            question,
            answer,
            category: document.getElementById('faqCategory').value || 'Общие',
            order: parseInt(document.getElementById('faqOrder').value) || 1,
            tags: document.getElementById('faqTags').value.split(',').map(t => t.trim()).filter(t => t),
            active: document.getElementById('faqActive').checked,
            updatedAt: new Date().toISOString()
        };
        
        if (faqId) {
            faqData.id = faqId;
        }
        
        await saveFaqToStorage(faqData);
        
        showMessage(faqId ? 'Вопрос обновлен!' : 'Вопрос добавлен!', 'success');
        
        await loadFaqList();
        document.querySelector('[data-subtab="faq-list"]').click();
        resetFaqForm();
        
    } catch (error) {
        console.error('Error saving FAQ:', error);
        showMessage('Ошибка сохранения: ' + error.message, 'error');
    } finally {
        submitText.style.display = 'inline';
        hideLoading(submitLoading);
    }
}

function resetFaqForm() {
    document.getElementById('faqForm').reset();
    document.getElementById('editingFaqId').value = '';
    document.getElementById('faqSubmitText').textContent = 'Сохранить вопрос';
    document.getElementById('deleteFaqBtn').style.display = 'none';
    document.getElementById('faqOrder').value = '1';
    document.getElementById('faqActive').checked = true;
    showMessage('Форма очищена', 'info');
}

async function editFaq(faqId) {
    try {
        const faqs = await getFaqFromStorage();
        const faq = faqs.find(f => f.id === faqId);
        
        if (!faq) {
            showMessage('Вопрос не найден', 'error');
            return;
        }
        
        document.getElementById('faqQuestion').value = faq.question || '';
        document.getElementById('faqAnswer').value = faq.answer || '';
        document.getElementById('faqCategory').value = faq.category || '';
        document.getElementById('faqOrder').value = faq.order || 1;
        document.getElementById('faqTags').value = (faq.tags || []).join(', ');
        document.getElementById('faqActive').checked = faq.active !== false;
        document.getElementById('editingFaqId').value = faqId;
        document.getElementById('faqSubmitText').textContent = 'Обновить вопрос';
        document.getElementById('deleteFaqBtn').style.display = 'inline-block';
        
        document.querySelector('[data-subtab="edit-faq"]').click();
        
    } catch (error) {
        console.error('Error loading FAQ:', error);
        showMessage('Ошибка загрузки вопроса', 'error');
    }
}

async function deleteFaq(faqId) {
    if (!confirm('Вы уверены, что хотите удалить этот вопрос?')) {
        return;
    }
    
    try {
        const faqs = await getFaqFromStorage();
        const filteredFaqs = faqs.filter(f => f.id !== faqId);
        
        localStorage.setItem('petochania_faq', JSON.stringify(filteredFaqs));
        
        showMessage('Вопрос удален!', 'success');
        
        await loadFaqList();
        
        if (document.getElementById('editingFaqId').value === faqId) {
            resetFaqForm();
            document.querySelector('[data-subtab="faq-list"]').click();
        }
        
    } catch (error) {
        console.error('Error deleting FAQ:', error);
        showMessage('Ошибка удаления вопроса', 'error');
    }
}

async function filterFaq(searchTerm) {
    try {
        const faqs = await getFaqFromStorage();
        const tbody = document.getElementById('faqTableBody');
        
        if (!searchTerm) {
            loadFaqList();
            return;
        }
        
        const filteredFaqs = faqs.filter(faq => 
            (faq.question && faq.question.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (faq.answer && faq.answer.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (faq.category && faq.category.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (faq.tags && faq.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase())))
        );
        
        if (filteredFaqs.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; color: #7f8c8d;">
                        Вопросы не найдены
                    </td>
                </tr>
            `;
            return;
        }
        
        tbody.innerHTML = '';
        
        filteredFaqs.forEach((faq, index) => {
            const row = document.createElement('tr');
            const answerPreview = faq.answer.length > 100 ? 
                faq.answer.substring(0, 100) + '...' : faq.answer;
            
            row.innerHTML = `
                <td>${index + 1}</td>
                <td><strong>${faq.question}</strong></td>
                <td>${answerPreview}</td>
                <td>${faq.category || 'Общие'}</td>
                <td>${faq.order || 1}</td>
                <td>
                    <div class="actions">
                        <button class="btn btn-primary action-btn" onclick="editFaq('${faq.id}')">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                        <button class="btn btn-danger action-btn" onclick="deleteFaq('${faq.id}')">
                            <i class="fas fa-trash"></i> Удалить
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    } catch (error) {
        console.error('Error filtering FAQ:', error);
    }
}

// =================================== REVIEWS MANAGEMENT ===================================
let currentReviewImage = null;

function initReviewsManagement() {
    document.getElementById('addReviewBtn').addEventListener('click', function() {
        resetReviewForm();
        document.querySelector('[data-subtab="edit-review"]').click();
    });

    document.getElementById('reviewForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        await saveReview();
    });

    document.getElementById('resetReviewForm').addEventListener('click', resetReviewForm);
    
    document.getElementById('deleteReviewBtn').addEventListener('click', async function() {
        const reviewId = document.getElementById('editingReviewId').value;
        if (!reviewId) return;
        
        const author = document.getElementById('reviewAuthor').value;
        
        if (confirm(`Вы уверены, что хотите удалить отзыв от "${author}"?`)) {
            await deleteReview(reviewId);
        }
    });

    document.getElementById('searchReviews').addEventListener('input', function(e) {
        filterReviews(e.target.value);
    });

    // Rating stars
    const stars = document.querySelectorAll('#ratingStars i');
    stars.forEach(star => {
        star.addEventListener('click', function() {
            const rating = parseInt(this.getAttribute('data-rating'));
            document.getElementById('reviewRating').value = rating;
            
            stars.forEach((s, index) => {
                s.style.color = index < rating ? '#ffc107' : '#ddd';
            });
        });
        
        star.addEventListener('mouseenter', function() {
            const rating = parseInt(this.getAttribute('data-rating'));
            stars.forEach((s, index) => {
                s.style.color = index < rating ? '#ffc107' : '#ddd';
            });
        });
        
        star.addEventListener('mouseleave', function() {
            const currentRating = parseInt(document.getElementById('reviewRating').value);
            stars.forEach((s, index) => {
                s.style.color = index < currentRating ? '#ffc107' : '#ddd';
            });
        });
    });

    // Image upload
    document.getElementById('reviewImageUpload').addEventListener('click', function() {
        document.getElementById('reviewImage').click();
    });
    
    document.getElementById('reviewImage').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file && !file.type.startsWith('image/')) {
            showMessage('Пожалуйста, выберите изображение', 'error');
            return;
        }
        
        if (file && file.size > 5 * 1024 * 1024) {
            showMessage('Изображение слишком большое (макс. 5MB)', 'error');
            return;
        }
        
        currentReviewImage = file;
        const preview = document.getElementById('reviewImagePreview');
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `
                    <div class="uploaded-image">
                        <img src="${e.target.result}" alt="Review author">
                        <div class="remove-image" onclick="removeReviewImage()">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }
    });
}

function removeReviewImage() {
    currentReviewImage = null;
    document.getElementById('reviewImagePreview').innerHTML = '';
    document.getElementById('reviewImage').value = '';
}

async function loadReviewsList() {
    try {
        const reviews = await getReviewsFromStorage();
        const tbody = document.getElementById('reviewsTableBody');
        
        if (!reviews || reviews.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; color: #7f8c8d;">
                        <i class="fas fa-star" style="font-size: 48px; display: block; margin-bottom: 10px;"></i>
                        Нет добавленных отзывов
                    </td>
                </tr>
            `;
            return;
        }
        
        tbody.innerHTML = '';
        
        // Sort by date (newest first)
        reviews.sort((a, b) => new Date(b.date || b.createdAt) - new Date(a.date || a.createdAt));
        
        reviews.forEach((review, index) => {
            const row = document.createElement('tr');
            const textPreview = review.text.length > 100 ? 
                review.text.substring(0, 100) + '...' : review.text;
            const ratingStars = '★'.repeat(review.rating || 5) + '☆'.repeat(5 - (review.rating || 5));
            
            row.innerHTML = `
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        ${review.image ? 
                            `<img src="${review.image}" alt="${review.author}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : 
                            `<div style="width: 40px; height: 40px; border-radius: 50%; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user" style="color: #C8A97E;"></i>
                            </div>`
                        }
                        <strong>${review.author || 'Аноним'}</strong>
                    </div>
                </td>
                <td>${textPreview}</td>
                <td>
                    <span style="color: #ffc107; font-size: 16px;">${ratingStars}</span>
                    <br><small>(${review.rating || 5}/5)</small>
                </td>
                <td>${review.city || '-'}</td>
                <td>${review.date ? new Date(review.date).toLocaleDateString('ru-RU') : 
                    (review.createdAt ? new Date(review.createdAt).toLocaleDateString('ru-RU') : '-')}</td>
                <td>
                    <div class="actions">
                        <button class="btn btn-primary action-btn" onclick="editReview('${review.id}')">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                        <button class="btn btn-danger action-btn" onclick="deleteReview('${review.id}')">
                            <i class="fas fa-trash"></i> Удалить
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    } catch (error) {
        console.error('Error loading reviews:', error);
    }
}

async function getReviewsFromStorage() {
    try {
        const data = JSON.parse(localStorage.getItem('petochania_reviews') || '[]');
        return Array.isArray(data) ? data : [];
    } catch (error) {
        console.error('Error getting reviews from storage:', error);
        return [];
    }
}

async function saveReviewToStorage(reviewData) {
    try {
        let reviews = await getReviewsFromStorage();
        
        if (reviewData.id) {
            const index = reviews.findIndex(r => r.id === reviewData.id);
            if (index !== -1) {
                reviews[index] = { ...reviews[index], ...reviewData, updatedAt: new Date().toISOString() };
            } else {
                reviewData.id = 'review_' + Date.now();
                reviewData.createdAt = new Date().toISOString();
                reviews.push(reviewData);
            }
        } else {
            reviewData.id = 'review_' + Date.now();
            reviewData.createdAt = new Date().toISOString();
            reviews.push(reviewData);
        }
        
        localStorage.setItem('petochania_reviews', JSON.stringify(reviews));
        return reviewData;
    } catch (error) {
        console.error('Error saving review to storage:', error);
        throw error;
    }
}

async function saveReview() {
    const author = document.getElementById('reviewAuthor').value;
    const text = document.getElementById('reviewText').value;
    const reviewId = document.getElementById('editingReviewId').value;
    
    if (!author || !text) {
        showMessage('Пожалуйста, заполните все обязательные поля', 'error');
        return;
    }
    
    const submitText = document.getElementById('reviewSubmitText');
    const submitLoading = document.getElementById('reviewSubmitLoading');
    
    try {
        submitText.style.display = 'none';
        showLoading(submitLoading);
        
        const reviewData = {
            author,
            text,
            rating: parseInt(document.getElementById('reviewRating').value) || 5,
            city: document.getElementById('reviewCity').value || '',
            date: document.getElementById('reviewDate').value || new Date().toISOString().split('T')[0],
            featured: document.getElementById('reviewFeatured').checked,
            active: document.getElementById('reviewActive').checked,
            updatedAt: new Date().toISOString()
        };
        
        // Process image
        if (currentReviewImage) {
            const base64Image = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                reader.readAsDataURL(currentReviewImage);
            });
            reviewData.image = base64Image;
        } else {
            // Keep existing image if editing
            const preview = document.getElementById('reviewImagePreview');
            const existingImg = preview.querySelector('img');
            if (existingImg && existingImg.src) {
                reviewData.image = existingImg.src;
            }
        }
        
        if (reviewId) {
            reviewData.id = reviewId;
        }
        
        await saveReviewToStorage(reviewData);
        
        showMessage(reviewId ? 'Отзыв обновлен!' : 'Отзыв добавлен!', 'success');
        
        await loadReviewsList();
        document.querySelector('[data-subtab="reviews-list"]').click();
        resetReviewForm();
        
    } catch (error) {
        console.error('Error saving review:', error);
        showMessage('Ошибка сохранения: ' + error.message, 'error');
    } finally {
        submitText.style.display = 'inline';
        hideLoading(submitLoading);
    }
}

function resetReviewForm() {
    document.getElementById('reviewForm').reset();
    document.getElementById('editingReviewId').value = '';
    document.getElementById('reviewSubmitText').textContent = 'Сохранить отзыв';
    document.getElementById('deleteReviewBtn').style.display = 'none';
    document.getElementById('reviewDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('reviewImagePreview').innerHTML = '';
    currentReviewImage = null;
    
    // Reset rating stars
    document.getElementById('reviewRating').value = 5;
    const stars = document.querySelectorAll('#ratingStars i');
    stars.forEach((s, index) => {
        s.style.color = index < 5 ? '#ffc107' : '#ddd';
    });
    
    showMessage('Форма очищена', 'info');
}

async function editReview(reviewId) {
    try {
        const reviews = await getReviewsFromStorage();
        const review = reviews.find(r => r.id === reviewId);
        
        if (!review) {
            showMessage('Отзыв не найден', 'error');
            return;
        }
        
        document.getElementById('reviewAuthor').value = review.author || '';
        document.getElementById('reviewText').value = review.text || '';
        document.getElementById('reviewCity').value = review.city || '';
        document.getElementById('reviewDate').value = review.date || 
            (review.createdAt ? review.createdAt.split('T')[0] : '');
        document.getElementById('reviewFeatured').checked = review.featured || false;
        document.getElementById('reviewActive').checked = review.active !== false;
        document.getElementById('editingReviewId').value = reviewId;
        document.getElementById('reviewSubmitText').textContent = 'Обновить отзыв';
        document.getElementById('deleteReviewBtn').style.display = 'inline-block';
        
        // Set rating
        const rating = review.rating || 5;
        document.getElementById('reviewRating').value = rating;
        const stars = document.querySelectorAll('#ratingStars i');
        stars.forEach((s, index) => {
            s.style.color = index < rating ? '#ffc107' : '#ddd';
        });
        
        // Show image
        const preview = document.getElementById('reviewImagePreview');
        preview.innerHTML = '';
        if (review.image) {
            preview.innerHTML = `
                <div class="uploaded-image">
                    <img src="${review.image}" alt="Review author">
                    <div class="remove-image" onclick="removeReviewImage()">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            `;
        }
        
        document.querySelector('[data-subtab="edit-review"]').click();
        
    } catch (error) {
        console.error('Error loading review:', error);
        showMessage('Ошибка загрузки отзыва', 'error');
    }
}

async function deleteReview(reviewId) {
    if (!confirm('Вы уверены, что хотите удалить этот отзыв?')) {
        return;
    }
    
    try {
        const reviews = await getReviewsFromStorage();
        const filteredReviews = reviews.filter(r => r.id !== reviewId);
        
        localStorage.setItem('petochania_reviews', JSON.stringify(filteredReviews));
        
        showMessage('Отзыв удален!', 'success');
        
        await loadReviewsList();
        
        if (document.getElementById('editingReviewId').value === reviewId) {
            resetReviewForm();
            document.querySelector('[data-subtab="reviews-list"]').click();
        }
        
    } catch (error) {
        console.error('Error deleting review:', error);
        showMessage('Ошибка удаления отзыва', 'error');
    }
}

async function filterReviews(searchTerm) {
    try {
        const reviews = await getReviewsFromStorage();
        const tbody = document.getElementById('reviewsTableBody');
        
        if (!searchTerm) {
            loadReviewsList();
            return;
        }
        
        const filteredReviews = reviews.filter(review => 
            (review.author && review.author.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (review.text && review.text.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (review.city && review.city.toLowerCase().includes(searchTerm.toLowerCase()))
        );
        
        if (filteredReviews.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; color: #7f8c8d;">
                        Отзывы не найдены
                    </td>
                </tr>
            `;
            return;
        }
        
        tbody.innerHTML = '';
        
        filteredReviews.forEach((review, index) => {
            const row = document.createElement('tr');
            const textPreview = review.text.length > 100 ? 
                review.text.substring(0, 100) + '...' : review.text;
            const ratingStars = '★'.repeat(review.rating || 5) + '☆'.repeat(5 - (review.rating || 5));
            
            row.innerHTML = `
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        ${review.image ? 
                            `<img src="${review.image}" alt="${review.author}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : 
                            `<div style="width: 40px; height: 40px; border-radius: 50%; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user" style="color: #C8A97E;"></i>
                            </div>`
                        }
                        <strong>${review.author || 'Аноним'}</strong>
                    </div>
                </td>
                <td>${textPreview}</td>
                <td>
                    <span style="color: #ffc107; font-size: 16px;">${ratingStars}</span>
                    <br><small>(${review.rating || 5}/5)</small>
                </td>
                <td>${review.city || '-'}</td>
                <td>${review.date ? new Date(review.date).toLocaleDateString('ru-RU') : 
                    (review.createdAt ? new Date(review.createdAt).toLocaleDateString('ru-RU') : '-')}</td>
                <td>
                    <div class="actions">
                        <button class="btn btn-primary action-btn" onclick="editReview('${review.id}')">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                        <button class="btn btn-danger action-btn" onclick="deleteReview('${review.id}')">
                            <i class="fas fa-trash"></i> Удалить
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    } catch (error) {
        console.error('Error filtering reviews:', error);
    }
}

// =================================== VIDEOS MANAGEMENT ===================================
let currentVideoThumbnail = null;
let currentVideoFile = null;

function initVideosManagement() {
    document.getElementById('addVideoBtn').addEventListener('click', function() {
        resetVideoForm();
        document.querySelector('[data-subtab="edit-video"]').click();
    });

    document.getElementById('videoForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        await saveVideo();
    });

    document.getElementById('resetVideoForm').addEventListener('click', resetVideoForm);
    
    document.getElementById('deleteVideoBtn').addEventListener('click', async function() {
        const videoId = document.getElementById('editingVideoId').value;
        if (!videoId) return;
        
        const title = document.getElementById('videoTitle').value;
        
        if (confirm(`Вы уверены, что хотите удалить видео "${title}"?`)) {
            await deleteVideo(videoId);
        }
    });

    document.getElementById('searchVideos').addEventListener('input', function(e) {
        filterVideos(e.target.value);
    });

    // Thumbnail upload
    document.getElementById('videoThumbnailUpload').addEventListener('click', function() {
        document.getElementById('videoThumbnail').click();
    });
    
    document.getElementById('videoThumbnail').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file && !file.type.startsWith('image/')) {
            showMessage('Пожалуйста, выберите изображение', 'error');
            return;
        }
        
        if (file && file.size > 5 * 1024 * 1024) {
            showMessage('Изображение слишком большое (макс. 5MB)', 'error');
            return;
        }
        
        currentVideoThumbnail = file;
        const preview = document.getElementById('videoThumbnailPreview');
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `
                    <div class="uploaded-image">
                        <img src="${e.target.result}" alt="Video thumbnail">
                        <div class="remove-image" onclick="removeVideoThumbnail()">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }
    });

    // Video file upload
    document.getElementById('videoFileUpload').addEventListener('click', function() {
        document.getElementById('videoFile').click();
    });
    
    document.getElementById('videoFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file && !file.type.startsWith('video/')) {
            showMessage('Пожалуйста, выберите видео файл', 'error');
            return;
        }
        
        if (file && file.size > 50 * 1024 * 1024) {
            showMessage('Видео слишком большое (макс. 50MB)', 'error');
            return;
        }
        
        currentVideoFile = file;
        const preview = document.getElementById('videoFilePreview');
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `
                    <div class="uploaded-video">
                        <video controls style="width: 300px; max-width: 100%;">
                            <source src="${e.target.result}" type="${file.type}">
                            Ваш браузер не поддерживает видео.
                        </video>
                        <button class="remove-btn" onclick="removeVideoFile()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }
    });
}

function removeVideoThumbnail() {
    currentVideoThumbnail = null;
    document.getElementById('videoThumbnailPreview').innerHTML = '';
    document.getElementById('videoThumbnail').value = '';
}

function removeVideoFile() {
    currentVideoFile = null;
    document.getElementById('videoFilePreview').innerHTML = '';
    document.getElementById('videoFile').value = '';
}

async function loadVideosList() {
    try {
        const videos = await getVideosFromStorage();
        const grid = document.getElementById('videosGrid');
        
        if (!videos || videos.length === 0) {
            grid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #7f8c8d; border: 2px dashed #ddd; border-radius: 10px;">
                    <i class="fas fa-video-slash" style="font-size: 64px; margin-bottom: 20px; display: block; color: #C8A97E;"></i>
                    <h4>Нет добавленных видео</h4>
                    <p style="margin-bottom: 20px;">Добавьте видео для отображения на главной странице</p>
                    <button class="btn btn-success" id="addFirstVideoBtn">
                        <i class="fas fa-plus"></i> Добавить первое видео
                    </button>
                </div>
            `;
            
            document.getElementById('addFirstVideoBtn').addEventListener('click', function() {
                resetVideoForm();
                document.querySelector('[data-subtab="edit-video"]').click();
            });
            
            return;
        }
        
        // Sort by order and category
        videos.sort((a, b) => {
            if (a.category !== b.category) {
                return a.category === 'main' ? -1 : 1;
            }
            return (a.order || 999) - (b.order || 999);
        });
        
        grid.innerHTML = '';
        
        videos.forEach((video, index) => {
            const videoCard = document.createElement('div');
            videoCard.className = 'card';
            videoCard.style.overflow = 'hidden';
            
            let videoElement = '';
            if (video.type === 'youtube') {
                // Extract YouTube ID
                const videoId = extractYouTubeId(video.url);
                videoElement = `
                    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
                        <iframe 
                            src="https://www.youtube.com/embed/${videoId}?rel=0&showinfo=0" 
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" 
                            allowfullscreen>
                        </iframe>
                    </div>
                `;
            } else if (video.thumbnail) {
                videoElement = `
                    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
                        <img src="${video.thumbnail}" alt="${video.title}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-play" style="font-size: 48px; color: white; background: rgba(200, 169, 126, 0.8); width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center;"></i>
                        </div>
                    </div>
                `;
            } else {
                videoElement = `
                    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-video" style="font-size: 48px; color: #C8A97E;"></i>
                    </div>
                `;
            }
            
            const categoryBadges = {
                'main': '<span class="status-badge status-available" style="margin-right: 5px;">Главная</span>',
                'about': '<span class="status-badge status-reserved" style="margin-right: 5px;">О питомнике</span>',
                'breed': '<span class="status-badge status-sold" style="margin-right: 5px;">Породы</span>'
            };
            
            videoCard.innerHTML = `
                <div class="card-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h4 style="margin: 0; font-size: 16px; color: #2c3e50;">${video.title}</h4>
                        ${video.active ? '' : '<span style="color: #e74c3c; font-size: 12px;">(скрыто)</span>'}
                    </div>
                </div>
                ${videoElement}
                <div class="card-body">
                    <p style="font-size: 14px; color: #666; margin-bottom: 15px; height: 60px; overflow: hidden;">
                        ${video.description || 'Без описания'}
                    </p>
                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #95a5a6;">
                        <div>
                            ${categoryBadges[video.category] || ''}
                            <span>Порядок: ${video.order || 1}</span>
                        </div>
                        <div>
                            ${video.autoplay ? '<i class="fas fa-play-circle" title="Автовоспроизведение"></i>' : ''}
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="actions" style="display: flex; gap: 8px; width: 100%;">
                        <button class="btn btn-primary action-btn" onclick="editVideo('${video.id}')" style="flex: 1;">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                        <button class="btn btn-danger action-btn" onclick="deleteVideo('${video.id}')" style="flex: 1;">
                            <i class="fas fa-trash"></i> Удалить
                        </button>
                    </div>
                </div>
            `;
            grid.appendChild(videoCard);
        });
    } catch (error) {
        console.error('Error loading videos:', error);
    }
}

function extractYouTubeId(url) {
    const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
    const match = url.match(regExp);
    return (match && match[7].length === 11) ? match[7] : null;
}

async function getVideosFromStorage() {
    try {
        const data = JSON.parse(localStorage.getItem('petochania_videos') || '[]');
        return Array.isArray(data) ? data : [];
    } catch (error) {
        console.error('Error getting videos from storage:', error);
        return [];
    }
}

async function saveVideoToStorage(videoData) {
    try {
        let videos = await getVideosFromStorage();
        
        if (videoData.id) {
            const index = videos.findIndex(v => v.id === videoData.id);
            if (index !== -1) {
                videos[index] = { ...videos[index], ...videoData, updatedAt: new Date().toISOString() };
            } else {
                videoData.id = 'video_' + Date.now();
                videoData.createdAt = new Date().toISOString();
                videos.push(videoData);
            }
        } else {
            videoData.id = 'video_' + Date.now();
            videoData.createdAt = new Date().toISOString();
            videos.push(videoData);
        }
        
        localStorage.setItem('petochania_videos', JSON.stringify(videos));
        return videoData;
    } catch (error) {
        console.error('Error saving video to storage:', error);
        throw error;
    }
}

async function saveVideo() {
    const title = document.getElementById('videoTitle').value;
    const url = document.getElementById('videoUrl').value;
    const videoId = document.getElementById('editingVideoId').value;
    
    if (!title || !url) {
        showMessage('Пожалуйста, заполните все обязательные поля', 'error');
        return;
    }
    
    const submitText = document.getElementById('videoSubmitText');
    const submitLoading = document.getElementById('videoSubmitLoading');
    
    try {
        submitText.style.display = 'none';
        showLoading(submitLoading);
        
        const videoData = {
            title,
            url,
            type: document.getElementById('videoType').value,
            description: document.getElementById('videoDescription').value || '',
            order: parseInt(document.getElementById('videoOrder').value) || 1,
            category: document.getElementById('videoCategory').value,
            active: document.getElementById('videoActive').checked,
            autoplay: document.getElementById('videoAutoplay').checked,
            updatedAt: new Date().toISOString()
        };
        
        // Process thumbnail
        if (currentVideoThumbnail) {
            const base64Thumbnail = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                reader.readAsDataURL(currentVideoThumbnail);
            });
            videoData.thumbnail = base64Thumbnail;
        } else {
            // Keep existing thumbnail if editing
            const preview = document.getElementById('videoThumbnailPreview');
            const existingImg = preview.querySelector('img');
            if (existingImg && existingImg.src) {
                videoData.thumbnail = existingImg.src;
            }
        }
        
        // Process video file
        if (currentVideoFile) {
            const base64Video = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                reader.readAsDataURL(currentVideoFile);
            });
            videoData.videoFile = base64Video;
            videoData.videoType = currentVideoFile.type;
            videoData.videoName = currentVideoFile.name;
            videoData.type = 'uploaded';
        }
        
        // Extract YouTube ID if it's a YouTube video
        if (videoData.type === 'youtube') {
            const youtubeId = extractYouTubeId(videoData.url);
            if (youtubeId) {
                videoData.youtubeId = youtubeId;
                videoData.embedUrl = `https://www.youtube.com/embed/${youtubeId}`;
            }
        }
        
        if (videoId) {
            videoData.id = videoId;
        }
        
        await saveVideoToStorage(videoData);
        
        showMessage(videoId ? 'Видео обновлено!' : 'Видео добавлено!', 'success');
        
        await loadVideosList();
        document.querySelector('[data-subtab="videos-list"]').click();
        resetVideoForm();
        
    } catch (error) {
        console.error('Error saving video:', error);
        showMessage('Ошибка сохранения: ' + error.message, 'error');
    } finally {
        submitText.style.display = 'inline';
        hideLoading(submitLoading);
    }
}

function resetVideoForm() {
    document.getElementById('videoForm').reset();
    document.getElementById('editingVideoId').value = '';
    document.getElementById('videoSubmitText').textContent = 'Сохранить видео';
    document.getElementById('deleteVideoBtn').style.display = 'none';
    document.getElementById('videoOrder').value = '1';
    document.getElementById('videoCategory').value = 'main';
    document.getElementById('videoType').value = 'youtube';
    document.getElementById('videoActive').checked = true;
    document.getElementById('videoAutoplay').checked = true;
    
    document.getElementById('videoThumbnailPreview').innerHTML = '';
    document.getElementById('videoFilePreview').innerHTML = '';
    currentVideoThumbnail = null;
    currentVideoFile = null;
    
    showMessage('Форма очищена', 'info');
}

async function editVideo(videoId) {
    try {
        const videos = await getVideosFromStorage();
        const video = videos.find(v => v.id === videoId);
        
        if (!video) {
            showMessage('Видео не найдено', 'error');
            return;
        }
        
        document.getElementById('videoTitle').value = video.title || '';
        document.getElementById('videoUrl').value = video.url || '';
        document.getElementById('videoType').value = video.type || 'youtube';
        document.getElementById('videoDescription').value = video.description || '';
        document.getElementById('videoOrder').value = video.order || 1;
        document.getElementById('videoCategory').value = video.category || 'main';
        document.getElementById('videoActive').checked = video.active !== false;
        document.getElementById('videoAutoplay').checked = video.autoplay !== false;
        document.getElementById('editingVideoId').value = videoId;
        document.getElementById('videoSubmitText').textContent = 'Обновить видео';
        document.getElementById('deleteVideoBtn').style.display = 'inline-block';
        
        // Show thumbnail
        const thumbnailPreview = document.getElementById('videoThumbnailPreview');
        thumbnailPreview.innerHTML = '';
        if (video.thumbnail) {
            thumbnailPreview.innerHTML = `
                <div class="uploaded-image">
                    <img src="${video.thumbnail}" alt="Video thumbnail">
                    <div class="remove-image" onclick="removeVideoThumbnail()">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            `;
        }
        
        document.querySelector('[data-subtab="edit-video"]').click();
        
    } catch (error) {
        console.error('Error loading video:', error);
        showMessage('Ошибка загрузки видео', 'error');
    }
}

async function deleteVideo(videoId) {
    if (!confirm('Вы уверены, что хотите удалить это видео?')) {
        return;
    }
    
    try {
        const videos = await getVideosFromStorage();
        const filteredVideos = videos.filter(v => v.id !== videoId);
        
        localStorage.setItem('petochania_videos', JSON.stringify(filteredVideos));
        
        showMessage('Видео удалено!', 'success');
        
        await loadVideosList();
        
        if (document.getElementById('editingVideoId').value === videoId) {
            resetVideoForm();
            document.querySelector('[data-subtab="videos-list"]').click();
        }
        
    } catch (error) {
        console.error('Error deleting video:', error);
        showMessage('Ошибка удаления видео', 'error');
    }
}

async function filterVideos(searchTerm) {
    try {
        const videos = await getVideosFromStorage();
        const grid = document.getElementById('videosGrid');
        
        if (!searchTerm) {
            loadVideosList();
            return;
        }
        
        const filteredVideos = videos.filter(video => 
            (video.title && video.title.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (video.description && video.description.toLowerCase().includes(searchTerm.toLowerCase())) ||
            (video.category && video.category.toLowerCase().includes(searchTerm.toLowerCase()))
        );
        
        if (filteredVideos.length === 0) {
            grid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px 20px; color: #7f8c8d;">
                    <i class="fas fa-video-slash" style="font-size: 48px; margin-bottom: 20px; display: block;"></i>
                    <p>Видео не найдены</p>
                </div>
            `;
            return;
        }
        
        grid.innerHTML = '';
        
        filteredVideos.forEach((video, index) => {
            const videoCard = document.createElement('div');
            videoCard.className = 'card';
            videoCard.style.overflow = 'hidden';
            
            let videoElement = '';
            if (video.type === 'youtube' && video.youtubeId) {
                videoElement = `
                    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
                        <iframe 
                            src="https://www.youtube.com/embed/${video.youtubeId}?rel=0&showinfo=0" 
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" 
                            allowfullscreen>
                        </iframe>
                    </div>
                `;
            } else if (video.thumbnail) {
                videoElement = `
                    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
                        <img src="${video.thumbnail}" alt="${video.title}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-play" style="font-size: 48px; color: white; background: rgba(200, 169, 126, 0.8); width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center;"></i>
                        </div>
                    </div>
                `;
            } else {
                videoElement = `
                    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-video" style="font-size: 48px; color: #C8A97E;"></i>
                    </div>
                `;
            }
            
            const categoryBadges = {
                'main': '<span class="status-badge status-available" style="margin-right: 5px;">Главная</span>',
                'about': '<span class="status-badge status-reserved" style="margin-right: 5px;">О питомнике</span>',
                'breed': '<span class="status-badge status-sold" style="margin-right: 5px;">Породы</span>'
            };
            
            videoCard.innerHTML = `
                <div class="card-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h4 style="margin: 0; font-size: 16px; color: #2c3e50;">${video.title}</h4>
                        ${video.active ? '' : '<span style="color: #e74c3c; font-size: 12px;">(скрыто)</span>'}
                    </div>
                </div>
                ${videoElement}
                <div class="card-body">
                    <p style="font-size: 14px; color: #666; margin-bottom: 15px; height: 60px; overflow: hidden;">
                        ${video.description || 'Без описания'}
                    </p>
                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #95a5a6;">
                        <div>
                            ${categoryBadges[video.category] || ''}
                            <span>Порядок: ${video.order || 1}</span>
                        </div>
                        <div>
                            ${video.autoplay ? '<i class="fas fa-play-circle" title="Автовоспроизведение"></i>' : ''}
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="actions" style="display: flex; gap: 8px; width: 100%;">
                        <button class="btn btn-primary action-btn" onclick="editVideo('${video.id}')" style="flex: 1;">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                        <button class="btn btn-danger action-btn" onclick="deleteVideo('${video.id}')" style="flex: 1;">
                            <i class="fas fa-trash"></i> Удалить
                        </button>
                    </div>
                </div>
            `;
            grid.appendChild(videoCard);
        });
    } catch (error) {
        console.error('Error filtering videos:', error);
    }
}

// =================================== SETTINGS MANAGEMENT ===================================
function initSettingsManagement() {
    document.getElementById('siteSettingsForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        await saveSiteSettings();
    });

    document.getElementById('socialSettingsForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        await saveSocialSettings();
    });

    document.getElementById('seoSettingsForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        await saveSeoSettings();
    });

    document.getElementById('syncSettingsForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        await saveSyncSettings();
    });

    // Загрузка текущих настроек синхронизации
    async function loadSyncSettings() {
        // Ждем загрузки sync-config если доступен
        if (window.syncConfigLoader) {
            await window.syncConfigLoader.loadConfig();
        }
        
        const token = localStorage.getItem('petochania_github_token');
        // Пробуем получить Gist ID из разных источников
        let gistId = localStorage.getItem('petochania_gist_id');
        if (!gistId && window.syncConfigLoader) {
            gistId = window.syncConfigLoader.getGistId();
        }
        if (!gistId && window.githubSyncBackend && window.githubSyncBackend.gistId) {
            gistId = window.githubSyncBackend.gistId;
        }
        
        if (token) {
            const tokenInput = document.getElementById('githubToken');
            if (tokenInput) {
                tokenInput.value = token;
                const gistIdGroup = document.getElementById('gistIdGroup');
                if (gistIdGroup) {
                    gistIdGroup.style.display = 'block';
                }
            }
        }
        if (gistId) {
            const gistIdInput = document.getElementById('gistId');
            if (gistIdInput) {
                gistIdInput.value = gistId;
                // Сохраняем в localStorage для быстрого доступа
                localStorage.setItem('petochania_gist_id', gistId);
            }
        }
        
        updateSyncStatus();
    }

    // Сохранение настроек синхронизации
    async function saveSyncSettings() {
        const token = document.getElementById('githubToken').value.trim();
        const gistId = document.getElementById('gistId').value.trim();
        
        const submitText = document.getElementById('syncSubmitText');
        const submitLoading = document.getElementById('syncSubmitLoading');
        const statusDiv = document.getElementById('syncStatus');
        
        try {
            submitText.style.display = 'none';
            showLoading(submitLoading);
            statusDiv.style.display = 'none';
            
            if (!token) {
                throw new Error('Введите GitHub Personal Access Token');
            }
            
            if (!window.githubSyncBackend) {
                throw new Error('GitHub Sync Backend не загружен');
            }
            
            const result = await window.githubSyncBackend.setup(token, gistId || null);
            
            // Обновляем конфигурационный файл для всех пользователей
            if (result.gistId) {
                await updateSyncConfigFile(result.gistId);
                // Сохраняем Gist ID в localStorage для надежности
                localStorage.setItem('petochania_gist_id', result.gistId);
            }
            
            // Переинициализируем бекенд
            // Сбрасываем флаг initialized чтобы принудительно переинициализировать
            if (window.githubSyncBackend) {
                window.githubSyncBackend.initialized = false;
            }
            await initBackend();
            
            // Обновляем форму настроек с новым Gist ID
            await loadSyncSettings();
            
            // Проверяем, что backend правильно инициализирован
            if (backend && typeof backend === 'object' && backend.initialized) {
                console.log('✅ Backend успешно переинициализирован с Gist ID:', backend.gistId);
            } else {
                console.warn('⚠️ Backend не был правильно инициализирован после сохранения настроек');
            }
            
            statusDiv.className = 'alert alert-success';
            statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> Настройки синхронизации сохранены успешно!<br><small>Gist ID: ' + result.gistId + '</small><br><small>Gist ID автоматически доступен всем пользователям</small>';
            statusDiv.style.display = 'block';
            
            updateSyncStatus();
            showMessage('Настройки синхронизации сохранены. Gist ID: ' + result.gistId, 'success');
            
        } catch (error) {
            console.error('Error saving sync settings:', error);
            statusDiv.className = 'alert alert-danger';
            statusDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Ошибка: ' + error.message;
            statusDiv.style.display = 'block';
            showMessage('Ошибка сохранения настроек: ' + error.message, 'error');
        } finally {
            submitText.style.display = 'inline';
            hideLoading(submitLoading);
        }
    }

    // Тестирование соединения
    async function testSyncConnection() {
        const token = document.getElementById('githubToken').value.trim();
        const statusDiv = document.getElementById('syncStatus');
        
        if (!token) {
            statusDiv.className = 'alert alert-warning';
            statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Введите GitHub токен для проверки';
            statusDiv.style.display = 'block';
            return;
        }
        
        try {
            statusDiv.className = 'alert alert-info';
            statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Проверка соединения...';
            statusDiv.style.display = 'block';
            
            // Проверяем токен через API
            const response = await fetch('https://api.github.com/user', {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            if (!response.ok) {
                throw new Error('Неверный токен или недостаточно прав');
            }
            
            const user = await response.json();
            
            statusDiv.className = 'alert alert-success';
            statusDiv.innerHTML = `<i class="fas fa-check-circle"></i> Соединение успешно! Пользователь: ${user.login}`;
            statusDiv.style.display = 'block';
            
        } catch (error) {
            console.error('Error testing connection:', error);
            statusDiv.className = 'alert alert-danger';
            statusDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> Ошибка: ' + error.message;
            statusDiv.style.display = 'block';
        }
    }

    // Обновление статуса синхронизации
    function updateSyncStatus() {
        const backendTypeEl = document.getElementById('backendType');
        const gistIdEl = document.getElementById('currentGistId');
        const lastSyncEl = document.getElementById('lastSyncTime');
        
        if (backend === 'express') {
            backendTypeEl.textContent = 'Локальный Express API';
        } else if (backend && backend.initialized && window.githubSyncBackend && backend === window.githubSyncBackend) {
            backendTypeEl.textContent = 'GitHub Sync Backend (бесплатный)';
            const gistId = localStorage.getItem('petochania_gist_id') || window.syncConfigLoader?.getGistId();
            gistIdEl.textContent = gistId || 'Не настроен';
        } else {
            backendTypeEl.textContent = 'localStorage (только локально)';
        }
        
        const lastSync = localStorage.getItem('petochania_last_sync');
        if (lastSync) {
            const date = new Date(lastSync);
            lastSyncEl.textContent = date.toLocaleString('ru-RU');
        } else {
            lastSyncEl.textContent = 'Никогда';
        }
    }

    // Обновление конфигурационного файла для всех пользователей
    async function updateSyncConfigFile(gistId) {
        // Пытаемся обновить файл sync-config.json в репозитории через GitHub API
        // Это требует токен с правами на репозиторий
        const token = localStorage.getItem('petochania_github_token');
        if (!token) {
            console.warn('Токен не найден, конфигурационный файл не будет обновлен');
            return;
        }

        try {
            // Получаем информацию о репозитории из URL
            const repoInfo = getRepoInfoFromUrl();
            if (!repoInfo) {
                console.warn('Не удалось определить репозиторий из URL');
                return;
            }

            // Получаем текущий файл
            const fileUrl = `https://api.github.com/repos/${repoInfo.owner}/${repoInfo.repo}/contents/sync-config.json`;
            const fileResponse = await fetch(fileUrl, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            let sha = null;
            if (fileResponse.ok) {
                const fileData = await fileResponse.json();
                sha = fileData.sha;
            }

            // Обновляем файл
            const configContent = {
                gistId: gistId,
                lastUpdated: new Date().toISOString()
            };

            const updateResponse = await fetch(fileUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${token}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    message: 'Update sync config: Gist ID',
                    content: btoa(JSON.stringify(configContent, null, 2)),
                    sha: sha
                })
            });

            if (updateResponse.ok) {
                console.log('✅ Конфигурационный файл обновлен для всех пользователей');
            } else {
                const error = await updateResponse.json();
                console.warn('Не удалось обновить конфигурационный файл:', error.message);
                // Это не критично - Gist ID уже сохранен в localStorage
            }
        } catch (error) {
            console.warn('Ошибка обновления конфигурационного файла:', error);
            // Это не критично - Gist ID уже сохранен в localStorage
        }
    }

    // Получение информации о репозитории из URL
    function getRepoInfoFromUrl() {
        // Для GitHub Pages URL выглядит как: https://username.github.io/repo-name/
        const hostname = window.location.hostname;
        const pathname = window.location.pathname;

        if (hostname.includes('github.io')) {
            const parts = hostname.split('.');
            if (parts.length >= 2) {
                const owner = parts[0];
                // Извлекаем имя репозитория из pathname
                const pathParts = pathname.split('/').filter(p => p);
                const repo = pathParts[0] || 'petochania-master'; // fallback
                return { owner, repo };
            }
        }
        return null;
    }

    // Загружаем настройки синхронизации после инициализации backend
    // Это будет вызвано после загрузки DOM и инициализации backend

    // Site logo upload
    document.getElementById('siteLogoUpload').addEventListener('click', function() {
        document.getElementById('siteLogo').click();
    });
    
    document.getElementById('siteLogo').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file && !file.type.startsWith('image/')) {
            showMessage('Пожалуйста, выберите изображение', 'error');
            return;
        }
        
        if (file && file.size > 5 * 1024 * 1024) {
            showMessage('Изображение слишком большое (макс. 5MB)', 'error');
            return;
        }
        
        const preview = document.getElementById('siteLogoPreview');
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `
                    <div class="uploaded-image">
                        <img src="${e.target.result}" alt="Site logo">
                        <div class="remove-image" onclick="document.getElementById('siteLogoPreview').innerHTML='';">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }
    });

    // Character counters
    document.getElementById('metaTitle').addEventListener('input', function() {
        document.getElementById('metaTitleCounter').textContent = 
            `${this.value.length}/60`;
    });
    
    document.getElementById('metaDescription').addEventListener('input', function() {
        document.getElementById('metaDescriptionCounter').textContent = 
            `${this.value.length}/160`;
    });

    loadSettings();
}

function addSocialLink() {
    const container = document.getElementById('socialLinksContainer');
    const index = container.children.length;
    
    const socialLinkHtml = `
        <div class="social-link-item" style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
            <div style="flex: 1;">
                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label>Название</label>
                        <input type="text" class="form-control social-name" placeholder="Например: Instagram" value="">
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label>URL</label>
                        <input type="url" class="form-control social-url" placeholder="https://instagram.com/petochania" value="">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Иконка FontAwesome</label>
                        <input type="text" class="form-control social-icon" placeholder="fab fa-instagram" value="">
                    </div>
                </div>
            </div>
            <button type="button" class="btn btn-danger" onclick="removeSocialLink(this)" style="align-self: flex-start; margin-top: 25px;">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', socialLinkHtml);
}

function removeSocialLink(button) {
    if (confirm('Удалить эту социальную сеть?')) {
        button.closest('.social-link-item').remove();
    }
}

async function loadSettings() {
    try {
        // Load site settings
        const siteSettings = JSON.parse(localStorage.getItem('petochania_site_settings') || '{}');
        if (siteSettings) {
            document.getElementById('siteTitle').value = siteSettings.title || 'Petochania';
            document.getElementById('siteTagline').value = siteSettings.tagline || 'Питомник элитных кошек';
            document.getElementById('contactPhone').value = siteSettings.phone || '8 926 150 2870';
            document.getElementById('contactEmail').value = siteSettings.email || '';
            document.getElementById('contactAddress').value = siteSettings.address || 'Москва, Россия';
            document.getElementById('workingHours').value = siteSettings.workingHours || 'Ежедневно 10:00 - 20:00';
            document.getElementById('siteDescription').value = siteSettings.description || '';
            
            const logoPreview = document.getElementById('siteLogoPreview');
            if (siteSettings.logo) {
                logoPreview.innerHTML = `
                    <div class="uploaded-image">
                        <img src="${siteSettings.logo}" alt="Site logo">
                        <div class="remove-image" onclick="document.getElementById('siteLogoPreview').innerHTML='';">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                `;
            }
        }

        // Load social settings
        const socialSettings = JSON.parse(localStorage.getItem('petochania_social_settings') || '[]');
        const socialContainer = document.getElementById('socialLinksContainer');
        socialContainer.innerHTML = '';
        
        if (socialSettings.length > 0) {
            socialSettings.forEach((social, index) => {
                socialContainer.innerHTML += `
                    <div class="social-link-item" style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <div style="flex: 1;">
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label>Название</label>
                                    <input type="text" class="form-control social-name" placeholder="Например: Instagram" value="${social.name || ''}">
                                </div>
                                <div class="form-group" style="flex: 2;">
                                    <label>URL</label>
                                    <input type="url" class="form-control social-url" placeholder="https://instagram.com/petochania" value="${social.url || ''}">
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label>Иконка FontAwesome</label>
                                    <input type="text" class="form-control social-icon" placeholder="fab fa-instagram" value="${social.icon || ''}">
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-danger" onclick="removeSocialLink(this)" style="align-self: flex-start; margin-top: 25px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            });
        }

        // Load SEO settings
        const seoSettings = JSON.parse(localStorage.getItem('petochania_seo_settings') || '{}');
        if (seoSettings) {
            document.getElementById('metaTitle').value = seoSettings.metaTitle || '';
            document.getElementById('metaDescription').value = seoSettings.metaDescription || '';
            document.getElementById('metaKeywords').value = seoSettings.metaKeywords || '';
            document.getElementById('googleAnalytics').value = seoSettings.googleAnalytics || '';
            
            // Update counters
            document.getElementById('metaTitleCounter').textContent = 
                `${document.getElementById('metaTitle').value.length}/60`;
            document.getElementById('metaDescriptionCounter').textContent = 
                `${document.getElementById('metaDescription').value.length}/160`;
        }
    } catch (error) {
        console.error('Error loading settings:', error);
    }
}

async function saveSiteSettings() {
    const submitText = document.getElementById('settingsSubmitText');
    const submitLoading = document.getElementById('settingsSubmitLoading');
    
    try {
        submitText.style.display = 'none';
        showLoading(submitLoading);
        
        const siteSettings = {
            title: document.getElementById('siteTitle').value,
            tagline: document.getElementById('siteTagline').value,
            phone: document.getElementById('contactPhone').value,
            email: document.getElementById('contactEmail').value,
            address: document.getElementById('contactAddress').value,
            workingHours: document.getElementById('workingHours').value,
            description: document.getElementById('siteDescription').value,
            updatedAt: new Date().toISOString()
        };
        
        // Process logo
        const logoPreview = document.getElementById('siteLogoPreview');
        const existingImg = logoPreview.querySelector('img');
        if (existingImg && existingImg.src) {
            siteSettings.logo = existingImg.src;
        }
        
        localStorage.setItem('petochania_site_settings', JSON.stringify(siteSettings));
        
        showMessage('Настройки сайта сохранены!', 'success');
        
    } catch (error) {
        console.error('Error saving site settings:', error);
        showMessage('Ошибка сохранения: ' + error.message, 'error');
    } finally {
        submitText.style.display = 'inline';
        hideLoading(submitLoading);
    }
}

async function saveSocialSettings() {
    const submitText = document.getElementById('socialSubmitText');
    const submitLoading = document.getElementById('socialSubmitLoading');
    
    try {
        submitText.style.display = 'none';
        showLoading(submitLoading);
        
        const socialLinks = [];
        const socialItems = document.querySelectorAll('.social-link-item');
        
        socialItems.forEach(item => {
            const name = item.querySelector('.social-name').value;
            const url = item.querySelector('.social-url').value;
            const icon = item.querySelector('.social-icon').value;
            
            if (name && url) {
                socialLinks.push({ name, url, icon });
            }
        });
        
        localStorage.setItem('petochania_social_settings', JSON.stringify(socialLinks));
        
        showMessage('Настройки социальных сетей сохранены!', 'success');
        
    } catch (error) {
        console.error('Error saving social settings:', error);
        showMessage('Ошибка сохранения: ' + error.message, 'error');
    } finally {
        submitText.style.display = 'inline';
        hideLoading(submitLoading);
    }
}

async function saveSeoSettings() {
    const submitText = document.getElementById('seoSubmitText');
    const submitLoading = document.getElementById('seoSubmitLoading');
    
    try {
        submitText.style.display = 'none';
        showLoading(submitLoading);
        
        const seoSettings = {
            metaTitle: document.getElementById('metaTitle').value,
            metaDescription: document.getElementById('metaDescription').value,
            metaKeywords: document.getElementById('metaKeywords').value,
            googleAnalytics: document.getElementById('googleAnalytics').value,
            updatedAt: new Date().toISOString()
        };
        
        localStorage.setItem('petochania_seo_settings', JSON.stringify(seoSettings));
        
        showMessage('SEO настройки сохранены!', 'success');
        
    } catch (error) {
        console.error('Error saving SEO settings:', error);
        showMessage('Ошибка сохранения: ' + error.message, 'error');
    } finally {
        submitText.style.display = 'inline';
        hideLoading(submitLoading);
    }
}

// =================================== INITIALIZATION ===================================
document.addEventListener('DOMContentLoaded', async function() {
    // ... existing code ...
    
    // Initialize new management systems
    initFaqManagement();
    initReviewsManagement();
    initVideosManagement();
    initSettingsManagement();
    
    // Инициализируем backend перед загрузкой данных
    await initBackend();
    
    // Синхронизируем данные из Gist если backend инициализирован или есть Gist ID
    const shouldSync = (backend && typeof backend === 'object' && backend.initialized) || 
                      (window.githubSyncBackend && window.githubSyncBackend.gistId) ||
                      localStorage.getItem('petochania_gist_id');
    
    if (shouldSync) {
        try {
            console.log('🔄 Синхронизация данных из GitHub Gist для новых разделов...');
            // Используем githubSyncBackend напрямую если он доступен
            const syncBackend = window.githubSyncBackend || backend;
            if (syncBackend && typeof syncBackend.loadData === 'function') {
                const gistData = await syncBackend.loadData();
                if (gistData) {
                    // Синхронизируем данные из Gist в localStorage
                    if (gistData.faq) {
                        localStorage.setItem('petochania_faq', JSON.stringify(gistData.faq));
                        console.log('✅ FAQ синхронизированы:', gistData.faq.length);
                    }
                    if (gistData.reviews) {
                        localStorage.setItem('petochania_reviews', JSON.stringify(gistData.reviews));
                        console.log('✅ Отзывы синхронизированы:', gistData.reviews.length);
                    }
                    if (gistData.videos) {
                        localStorage.setItem('petochania_videos', JSON.stringify(gistData.videos));
                        console.log('✅ Видео синхронизированы:', gistData.videos.length);
                    }
                    if (gistData.settings) {
                        localStorage.setItem('petochania_site_settings', JSON.stringify(gistData.settings));
                        console.log('✅ Настройки синхронизированы');
                    }
                    console.log('✅ Данные новых разделов успешно синхронизированы из GitHub Gist');
                    
                    // Принудительно обновляем интерфейс после синхронизации
                    if (authToken) {
                        console.log('🔄 Обновление интерфейса после синхронизации новых разделов...');
                        await loadFaqList();
                        await loadReviewsList();
                        await loadVideosList();
                        await loadSettings();
                        console.log('✅ Интерфейс новых разделов обновлен с синхронизированными данными');
                    }
                }
            }
        } catch (error) {
            console.error('❌ Не удалось синхронизировать данные из Gist:', error);
        }
    }
    
    // Загружаем настройки синхронизации после инициализации backend
    await loadSyncSettings();
    
    // Load initial data for new sections (если синхронизация не произошла выше или нужно обновить интерфейс)
    if (authToken) {
        // Всегда обновляем интерфейс, чтобы показать актуальные данные
        // Если синхронизация произошла выше, данные уже в localStorage
        await loadFaqList();
        await loadReviewsList();
        await loadVideosList();
        await loadSettings();
        
        // Load default data if empty
        await loadDefaultData();
        
        console.log('✅ Интерфейс новых разделов готов');
    }
});

async function loadDefaultData() {
    // Default FAQ
    const faqs = await getFaqFromStorage();
    if (faqs.length === 0) {
        const defaultFaqs = [
            {
                id: 'faq_1',
                question: 'Как выбрать подходящего котенка?',
                answer: 'Мы поможем подобрать идеального питомца, учитывая ваш образ жизни, опыт содержания кошек и личные предпочтения.',
                category: 'Общие вопросы',
                order: 1,
                tags: ['котята', 'выбор', 'помощь'],
                active: true,
                createdAt: new Date().toISOString()
            },
            {
                id: 'faq_2',
                question: 'Какие документы получает новый владелец?',
                answer: 'Полный пакет документов: ветеринарный паспорт, родословная, договор купли-продажи и рекомендации по уходу.',
                category: 'Документы',
                order: 2,
                tags: ['документы', 'родословная', 'паспорт'],
                active: true,
                createdAt: new Date().toISOString()
            },
            {
                id: 'faq_3',
                question: 'Возможна ли доставка в другие города?',
                answer: 'Да, мы организуем доставку котят в любую точку России и за границу с соблюдением всех норм безопасности.',
                category: 'Доставка',
                order: 3,
                tags: ['доставка', 'город', 'Россия'],
                active: true,
                createdAt: new Date().toISOString()
            }
        ];
        
        localStorage.setItem('petochania_faq', JSON.stringify(defaultFaqs));
    }
    
    // Default reviews
    const reviews = await getReviewsFromStorage();
    if (reviews.length === 0) {
        const defaultReviews = [
            {
                id: 'review_1',
                author: 'Анна',
                text: 'Покупали кошечку породы золотистая шиншилла. Невероятно красивая! Все знакомые восхищаются. Здоровая, ухоженная, с прекрасным характером. Спасибо за нашего питомца!',
                rating: 5,
                city: 'Москва, Россия',
                date: '2024-01-15',
                featured: true,
                active: true,
                createdAt: new Date().toISOString()
            },
            {
                id: 'review_2',
                author: 'Мария',
                text: 'Очень ответственные заводчики! Всегда на связи, помогают советами. Котенок привит, приучен к лотку и когтеточке. Родословная безупречная. Рекомендую этот питомник!',
                rating: 5,
                city: 'Санкт-Петербург, Россия',
                date: '2024-02-20',
                featured: true,
                active: true,
                createdAt: new Date().toISOString()
            },
            {
                id: 'review_3',
                author: 'Елена',
                text: 'Мы приобрели котенка в этом питомнике и остались очень довольны. Котенок здоровый, активный, с прекрасным характером. Все документы в порядке. Спасибо за профессиональный подход!',
                rating: 5,
                city: 'Киев, Украина',
                date: '2024-03-10',
                featured: true,
                active: true,
                createdAt: new Date().toISOString()
            }
        ];
        
        localStorage.setItem('petochania_reviews', JSON.stringify(defaultReviews));
    }
    
    // Default social links
    const socialSettings = JSON.parse(localStorage.getItem('petochania_social_settings') || '[]');
    if (socialSettings.length === 0) {
        const defaultSocial = [
            { name: "WhatsApp", url: "https://wa.me/message/Y4ZYRHELPNHUE1", icon: "fab fa-whatsapp" },
            { name: "Telegram", url: "https://t.me/tata_procats", icon: "fab fa-telegram" },
            { name: "Instagram", url: "https://www.instagram.com/petochania?igsh=MWR3bHhpNjhnd3g3dw%3D%3D&utm_source=qr", icon: "fab fa-instagram" },
            { name: "Facebook", url: "https://www.facebook.com/share/1A33qj8Nbm/?mibextid=wwXIfr", icon: "fab fa-facebook-f" },
            { name: "VK", url: "https://vk.com/petochania", icon: "fab fa-vk" },
            { name: "TikTok", url: "https://www.tiktok.com/@tata.vygodnaya?_t=ZS-90PLbDoj2kE&_r=1", icon: "fab fa-tiktok" }
        ];
        
        localStorage.setItem('petochania_social_settings', JSON.stringify(defaultSocial));
    }
}
    </script>
</body>
</html>
